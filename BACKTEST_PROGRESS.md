# ๐ ะัะพะณัะตัั ัะฐะทัะฐะฑะพัะบะธ ัะธััะตะผั ะฑัะบัะตััะธะฝะณะฐ

> **ะกัะฐััั:** ะ ัะฐะทัะฐะฑะพัะบะต  
> **ะะพัะปะตะดะฝะตะต ะพะฑะฝะพะฒะปะตะฝะธะต:** 2025-12-06  
> **ะกะฟัะธะฝั:** Sprint 4 - Backtesting System

---

## โ ะงัะพ ัะถะต ัะตะฐะปะธะทะพะฒะฐะฝะพ

### Task 4.2: ะััะพัะธัะตัะบะธะต ะดะฐะฝะฝัะต โ ะะะะะะจะะะ

#### 1. **ะะฐััะธัะตะฝ BybitClient** (`src/bybit_client.py`)

ะะพะฑะฐะฒะปะตะฝั ะผะตัะพะดั ะดะปั ัะฐะฑะพัั ั ะธััะพัะธัะตัะบะธะผะธ ะดะฐะฝะฝัะผะธ:

- **`get_historical_klines()`** - ะทะฐะณััะทะบะฐ ัะฒะตัะตะน ั Bybit API
  - ะะพะดะดะตัะถะบะฐ ัะฐะทะปะธัะฝัั ัะฐะนะผััะตะนะผะพะฒ: '1', '5', '15', '30', '60', '240', 'D', 'W'
  - ะะฐัะฐะผะตััั start_time, end_time ะดะปั ัะพัะฝะพะณะพ ะฟะตัะธะพะดะฐ
  - ะะธะผะธั ะดะพ 1000 ัะฒะตัะตะน ะทะฐ ะทะฐะฟัะพั (ะพะณัะฐะฝะธัะตะฝะธะต API)
  - ะะฒัะพะผะฐัะธัะตัะบะพะต ัะพัะผะฐัะธัะพะฒะฐะฝะธะต ะดะฐะฝะฝัั ะฒ ัะดะพะฑะฝัะน ัะพัะผะฐั

- **`get_historical_klines_range()`** - ัะผะฝะฐั ะทะฐะณััะทะบะฐ ะฑะพะปััะธั ะฟะตัะธะพะดะพะฒ
  - ะะฒัะพะผะฐัะธัะตัะบะฐั ะฟะฐะณะธะฝะฐัะธั ะดะปั ะฟะตัะธะพะดะพะฒ >1000 ัะฒะตัะตะน
  - ะะฐัะธัะฐ ะพั ะดัะฑะปะธะบะฐัะพะฒ
  - Rate limiting (ะทะฐะดะตัะถะบะฐ ะผะตะถะดั ะทะฐะฟัะพัะฐะผะธ)
  - ะะตัะฐะปัะฝะพะต ะปะพะณะธัะพะฒะฐะฝะธะต ะฟัะพัะตััะฐ

- **`_interval_to_milliseconds()`** - ะบะพะฝะฒะตััะฐัะธั ะธะฝัะตัะฒะฐะปะพะฒ
  - ะะพะดะดะตัะถะบะฐ ะฒัะตั ะฟะพะฟัะปััะฝัั ัะฐะนะผััะตะนะผะพะฒ
  - ะะพะทะฒัะฐัะฐะตั ะผะธะปะปะธัะตะบัะฝะดั ะดะปั ัะพัะฝัั ัะฐััะตัะพะฒ

**ะัะธะผะตั ะธัะฟะพะปัะทะพะฒะฐะฝะธั:**
```python
from bybit_client import BybitClient
from datetime import datetime, timedelta

bybit = BybitClient()

# ะะฐะณััะทะธัั ะฟะพัะปะตะดะฝะธะต 7 ะดะฝะตะน BTC
end_date = datetime.now()
start_date = end_date - timedelta(days=7)

klines = bybit.get_historical_klines_range(
    symbol='BTCUSDT',
    interval='15',  # 15-ะผะธะฝััะฝัะต ัะฒะตัะธ
    start_date=start_date,
    end_date=end_date
)

print(f"ะะฐะณััะถะตะฝะพ {len(klines)} ัะฒะตัะตะน")
# ะะฐะถะดะฐั ัะฒะตัะฐ: {'timestamp', 'open', 'high', 'low', 'close', 'volume', 'turnover', 'datetime'}
```

#### 2. **ะะฐััะธัะตะฝะฐ Database** (`src/database.py`)

ะะพะฑะฐะฒะปะตะฝะฐ ะฟะพะปะฝะพัะตะฝะฝะฐั ัะธััะตะผะฐ ะบะตัะธัะพะฒะฐะฝะธั:

- **ะะพะฒะฐั ัะฐะฑะปะธัะฐ `historical_klines`**
  - ะฅัะฐะฝะธั OHLCV ะดะฐะฝะฝัะต
  - ะฃะฝะธะบะฐะปัะฝะพััั ะฟะพ (symbol, interval, timestamp)
  - ะะฟัะธะผะธะทะธัะพะฒะฐะฝะฝัะต ะธะฝะดะตะบัั ะดะปั ะฑััััะพะณะพ ะฟะพะธัะบะฐ
  - ะะพะดะดะตัะถะบะฐ PostgreSQL ะธ SQLite

- **ะะตัะพะดั ัะฐะฑะพัั ั ะบะตัะตะผ:**
  - `save_historical_klines()` - ัะพััะฐะฝะตะฝะธะต ัะฒะตัะตะน ะฒ ะะ
  - `get_historical_klines_from_cache()` - ะทะฐะณััะทะบะฐ ะธะท ะบะตัะฐ ั ัะธะปัััะฐัะธะตะน
  - `check_cache_coverage()` - ะฟัะพะฒะตัะบะฐ ะฝะฐะปะธัะธั ะดะฐะฝะฝัั ะทะฐ ะฟะตัะธะพะด
  - `clear_historical_cache()` - ะพัะธััะบะฐ ััะฐััั ะดะฐะฝะฝัั

**ะะฝะดะตะบัั ะดะปั ะฟัะพะธะทะฒะพะดะธัะตะปัะฝะพััะธ:**
```sql
idx_historical_klines_symbol
idx_historical_klines_interval
idx_historical_klines_timestamp
idx_historical_klines_symbol_interval_timestamp  -- ัะพััะฐะฒะฝะพะน
```

#### 3. **ะกะพะทะดะฐะฝ DataLoader** (`src/data_loader.py`)

ะฃะผะฝัะน ะทะฐะณััะทัะธะบ ะดะฐะฝะฝัั ั ะฐะฒัะพะผะฐัะธัะตัะบะธะผ ะบะตัะธัะพะฒะฐะฝะธะตะผ:

**ะัะฝะพะฒะฝัะต ะฒะพะทะผะพะถะฝะพััะธ:**
- โ ะะฒัะพะผะฐัะธัะตัะบะพะต ะธัะฟะพะปัะทะพะฒะฐะฝะธะต ะบะตัะฐ ะบะพะณะดะฐ ะดะฐะฝะฝัะต ัะถะต ะทะฐะณััะถะตะฝั
- โ ะะฐะณััะทะบะฐ ัะพะปัะบะพ ะฝะตะดะพััะฐััะธั ะดะฐะฝะฝัั (ะทะฐะฟะพะปะฝะตะฝะธะต ะฟัะพะฟััะบะพะฒ)
- โ ะัะพะฒะตัะบะฐ ะฟะพะปะฝะพัั ะธ ะบะฐัะตััะฒะฐ ะดะฐะฝะฝัั
- โ ะะฐะบะตัะฝะฐั ะฟัะตะดะทะฐะณััะทะบะฐ ะดะปั ะฝะตัะบะพะปัะบะธั ัะธะผะฒะพะปะพะฒ
- โ ะฃะฟัะฐะฒะปะตะฝะธะต ะบะตัะตะผ (ะพัะธััะบะฐ ััะฐััั ะดะฐะฝะฝัั)
- โ ะะตัะฐะปัะฝะพะต ะปะพะณะธัะพะฒะฐะฝะธะต ะฒัะตั ะพะฟะตัะฐัะธะน

**ะะปััะตะฒัะต ะผะตัะพะดั:**

```python
from data_loader import DataLoader
from datetime import datetime, timedelta

loader = DataLoader()

# 1. ะะฐะณััะทะบะฐ ั ัะผะฝัะผ ะบะตัะธัะพะฒะฐะฝะธะตะผ
klines = loader.load_historical_data(
    symbol='BTCUSDT',
    interval='15',
    start_date=datetime.now() - timedelta(days=30),
    end_date=datetime.now(),
    use_cache=True  # ะัะฟะพะปัะทะพะฒะฐัั ะบะตั (ะฟะพ ัะผะพะปัะฐะฝะธั)
)

# 2. ะัะตะดะทะฐะณััะทะบะฐ ะดะปั ะฑัะบัะตััะฐ
all_data = loader.preload_data_for_backtest(
    symbols=['BTCUSDT', 'ETHUSDT', 'SOLUSDT'],
    interval='15',
    start_date=datetime.now() - timedelta(days=7),
    end_date=datetime.now()
)
# ะะพะทะฒัะฐัะฐะตั: {'BTCUSDT': [...], 'ETHUSDT': [...], 'SOLUSDT': [...]}

# 3. ะัะธััะบะฐ ััะฐัะพะณะพ ะบะตัะฐ
loader.clear_old_cache(days=30)  # ะฃะดะฐะปะธัั ะดะฐะฝะฝัะต ััะฐััะต 30 ะดะฝะตะน
```

**ะฃะผะฝัะต ัะธัะธ:**

1. **ะัะพะฒะตัะบะฐ ะฟะพะปะฝะพัั ะดะฐะฝะฝัั**
   - ะะฒัะพะผะฐัะธัะตัะบะธ ะพะฟัะตะดะตะปัะตั ะฟัะพะฟััะบะธ
   - ะะพะณััะถะฐะตั ัะพะปัะบะพ ะฝะตะดะพััะฐััะธะต ัะฒะตัะธ
   - ะัะพะฒะตััะตั ะณัะฐะฝะธัั ะฟะตัะธะพะดะฐ

2. **ะะฟัะธะผะธะทะฐัะธั ะทะฐะณััะทะบะธ**
   - ะะตัะฒัะน ะทะฐะฟัะพั: ะทะฐะณััะทะบะฐ ั API + ัะพััะฐะฝะตะฝะธะต ะฒ ะบะตั
   - ะะพะฒัะพัะฝัะน ะทะฐะฟัะพั: ะผะณะฝะพะฒะตะฝะฝะฐั ะทะฐะณััะทะบะฐ ะธะท ะะ
   - ะงะฐััะธัะฝัะต ะดะฐะฝะฝัะต: ะดะพะณััะทะบะฐ ัะพะปัะบะพ ะฟัะพะฟััะบะพะฒ

3. **ะฃะดะฐะปะตะฝะธะต ะดัะฑะปะธะบะฐัะพะฒ**
   - ะะฒัะพะผะฐัะธัะตัะบะฐั ัะธะปัััะฐัะธั ะฟะพะฒัะพััััะธััั ัะฒะตัะตะน
   - ะกะพััะธัะพะฒะบะฐ ะฟะพ ะฒัะตะผะตะฝะธ

#### 4. **ะขะตััะพะฒัะน ัะบัะธะฟั** (`src/test_data_loader.py`)

ะะฝัะตัะฐะบัะธะฒะฝัะน ัะบัะธะฟั ะดะปั ะฟัะพะฒะตัะบะธ ัะฐะฑะพัั ัะธััะตะผั:

```bash
# ะะฐะฟััะบ ัะตััะพะฒ
python src/test_data_loader.py
```

**ะงัะพ ัะตััะธััะตััั:**
- โ ะะฐะณััะทะบะฐ ะดะฐะฝะฝัั ั API
- โ ะะตัะธัะพะฒะฐะฝะธะต ะฒ ะะ
- โ ะะพะฒัะพัะฝะฐั ะทะฐะณััะทะบะฐ ะธะท ะบะตัะฐ
- โ ะัะตะดะทะฐะณััะทะบะฐ ะฝะตัะบะพะปัะบะธั ัะธะผะฒะพะปะพะฒ
- โ ะัะพะฒะตัะบะฐ ะฟะพะบัััะธั ะบะตัะฐ
- โ ะฃะฟัะฐะฒะปะตะฝะธะต ะบะตัะตะผ

---

## ๐ ะกัััะบัััะฐ ะดะฐะฝะฝัั

### ะคะพัะผะฐั ัะฒะตัะธ (OHLCV):
```python
{
    'timestamp': 1733500800000,           # Unix timestamp ะฒ ะผะธะปะปะธัะตะบัะฝะดะฐั
    'open': 43250.50,                      # ะฆะตะฝะฐ ะพัะบัััะธั
    'high': 43500.00,                      # ะะฐะบัะธะผะฐะปัะฝะฐั ัะตะฝะฐ
    'low': 43100.00,                       # ะะธะฝะธะผะฐะปัะฝะฐั ัะตะฝะฐ
    'close': 43420.75,                     # ะฆะตะฝะฐ ะทะฐะบัััะธั
    'volume': 152.345,                     # ะะฑัะตะผ ัะพัะณะพะฒ
    'turnover': 6624567.89,                # ะะฑะพัะพั ะฒ USDT
    'datetime': '2025-12-06T12:00:00'      # ISO ัะพัะผะฐั ะดะปั ัะดะพะฑััะฒะฐ
}
```

---

## โ ะงัะพ ัะตะฐะปะธะทะพะฒะฐะฝะพ ะดะฐะปััะต

### Task 4.1: ะกะพะทะดะฐัั Backtester ะบะปะฐัั โ ะะะะะะจะะะ

#### ะกะพะทะดะฐะฝ ะบะปะฐัั `BacktestEngine` (`src/backtester.py`)

**ะะปััะตะฒัะต ะพัะพะฑะตะฝะฝะพััะธ:**
- โ ะะฐัะปะตะดัะตััั ะพั `VirtualTradingBot` (ะฟะตัะตะธัะฟะพะปัะทะพะฒะฐะฝะธะต ะบะพะดะฐ!)
- โ ะะฐะฑะพัะฐะตั ั ะธััะพัะธัะตัะบะธะผะธ ะดะฐะฝะฝัะผะธ ะฒะผะตััะพ live
- โ ะะพะปะฝะฐั ัะธะผัะปััะธั ัะพัะณะพะฒะปะธ ะฝะฐ ะธััะพัะธะธ
- โ ะะฒัะพะผะฐัะธัะตัะบะธะน ัะฐััะตั ะผะตััะธะบ

**ะัะฝะพะฒะฝัะต ะผะตัะพะดั:**

```python
# ะะฐะฟััะบ ะฑัะบัะตััะฐ
results = engine.run_backtest(
    symbols=['BTCUSDT', 'ETHUSDT'],
    interval='15',
    start_date=datetime(...),
    end_date=datetime(...),
    initial_balance=10000.0
)

# ะะฝัััะตะฝะฝะธะต ะผะตัะพะดั:
- _load_historical_data()      # ะะฐะณััะทะบะฐ ะดะฐะฝะฝัั ัะตัะตะท DataLoader
- _simulate_trading()           # ะัะพะณะพะฝ ะฟะพ ะฒัะตะผะตะฝะฝะพะน ัะบะฐะปะต
- _create_timeline()            # ะกะพะทะดะฐะฝะธะต timeline ะธะท timestamp
- _process_historical_candle()  # ะะฑัะฐะฑะพัะบะฐ ะบะฐะถะดะพะน ัะฒะตัะธ
- _calculate_results()          # ะะฐััะตั ะผะตััะธะบ
- _print_report()               # ะัะฒะพะด ะพััะตัะฐ
```

**ะััะธัะตะบัััะฐ:**

```
BacktestEngine (extends VirtualTradingBot)
    โ
    โโโ ะะฐัะปะตะดัะตั ะฒัั ะปะพะณะธะบั ัะพัะณะพะฒะปะธ:
    โ   โโโ _execute_virtual_buy/sell
    โ   โโโ _close_virtual_position
    โ   โโโ calculate_position_size
    โ   โโโ calculate_stop_loss_take_profit
    โ   โโโ _check_virtual_position_conditions
    โ
    โโโ ะะพะฑะฐะฒะปัะตั ะฑัะบัะตััะธะฝะณ ััะฝะบัะธะพะฝะฐะป:
    โ   โโโ historical_data (Dict[symbol: List[candles]])
    โ   โโโ current_backtest_time (ัะตะบััะฐั ะฒัะตะผะตะฝะฝะฐั ัะพัะบะฐ)
    โ   โโโ timeline (ะฒัะตะผะตะฝะฝะฐั ัะบะฐะปะฐ)
    โ   โโโ backtest_results (ัะตะทัะปััะฐัั)
    โ
    โโโ ะัะฟะพะปัะทัะตั ะบะพะผะฟะพะฝะตะฝัั:
        โโโ DataLoader (ะทะฐะณััะทะบะฐ ะดะฐะฝะฝัั)
        โโโ Database (ะบะตั + ััะฐะฝะตะฝะธะต)
        โโโ DeepSeekClient (ัะพัะณะพะฒัะต ัะธะณะฝะฐะปั)
        โโโ BybitClient (ะธััะพัะธัะตัะบะธะต ะดะฐะฝะฝัะต)
```

**ะัะพัะตัั ะฑัะบัะตััะฐ:**

1. **ะะฐะณััะทะบะฐ ะดะฐะฝะฝัั** โ DataLoader ะทะฐะณััะถะฐะตั ะธััะพัะธั
2. **ะกะพะทะดะฐะฝะธะต timeline** โ ะัะต ัะฝะธะบะฐะปัะฝัะต timestamp
3. **ะกะธะผัะปััะธั** โ ะะปั ะบะฐะถะดะพะน ัะพัะบะธ ะฒัะตะผะตะฝะธ:
   - ะะพะปััะธัั ัะฒะตัั ะดะปั ะบะฐะถะดะพะณะพ ัะธะผะฒะพะปะฐ
   - ะะฑะฝะพะฒะธัั ัะตะฝั ะฟะพะทะธัะธะน
   - ะัะพะฒะตัะธัั stop-loss/take-profit
   - ะะพะปััะธัั ัะธะณะฝะฐะป ะพั AI
   - ะัะบัััั/ะทะฐะบัััั ะฟะพะทะธัะธะธ
4. **ะะฐััะตั ะผะตััะธะบ** โ ROI, Win Rate, Max DD ะธ ะดั.
5. **ะััะตั** โ ะัะฒะพะด ัะตะทัะปััะฐัะพะฒ

**ะขะตััะพะฒัะน ัะบัะธะฟั:** `src/test_backtest.py`

```bash
# ะะฐะฟััะบ ะฟัะพััะพะณะพ ะฑัะบัะตััะฐ
python src/test_backtest.py

# ะัะฒะพะด:
# ๐ ะะะะฃะกะ ะะญะะขะะกะขะ
# ๐ ะะฐะณััะทะบะฐ ะดะฐะฝะฝัั...
# ๐ฏ ะกะธะผัะปััะธั ัะพัะณะพะฒะปะธ...
# ๐ ะัะพะณัะตัั: 100%
# โ ะัะบัะตัั ะทะฐะฒะตััะตะฝ!
# ๐ ROI: +12.5%
# ๐ฏ Win Rate: 65.2%
```

**ะะตะทัะปััะฐัั ะฑัะบัะตััะฐ:**

```python
{
    'initial_balance': 10000.0,
    'final_balance': 11250.0,
    'total_pnl': 1250.0,
    'roi_percent': 12.5,
    'total_trades': 42,
    'winning_trades': 28,
    'losing_trades': 14,
    'win_rate': 66.67,
    'highest_balance': 11500.0,
    'lowest_balance': 9800.0,
    'max_drawdown': 14.78,
    'sharpe_ratio': 0.0,  # TODO: ัะปัััะธัั
    'profit_factor': 2.0  # TODO: ัะปัััะธัั
}
```

---

## โ Task 4.3: ะกะธะผัะปััะธั ัะพัะณะพะฒะปะธ - ะะะะะะจะะะ

### ะะตะฐะปะธะทะพะฒะฐะฝะพ:

#### 1. **ะฃัะตั ะบะพะผะธััะธะน ะฑะธัะถะธ** โ

ะะพะฑะฐะฒะปะตะฝะฐ ะฟะพะปะฝะฐั ะฟะพะดะดะตัะถะบะฐ ะบะพะผะธััะธะน Bybit:

- **ะะฐัััะพะนะบะธ ะฒ ะะ:**
  - `maker_fee_percent`: 0.055% (Bybit maker fee)
  - `taker_fee_percent`: 0.06% (Bybit taker fee)
  - `use_fees_in_backtest`: ะฒะบะปััะตะฝะธะต/ะฒัะบะปััะตะฝะธะต ะบะพะผะธััะธะน

- **ะะพะฒัะต ะฟะพะปั ะฒ `virtual_positions`:**
  - `entry_fee` - ะบะพะผะธััะธั ะฟัะธ ะพัะบัััะธะธ ะฟะพะทะธัะธะธ
  - `exit_fee` - ะบะพะผะธััะธั ะฟัะธ ะทะฐะบัััะธะธ ะฟะพะทะธัะธะธ
  - `total_fees` - ััะผะผะฐ ะฒัะตั ะบะพะผะธััะธะน ะฟะพ ะฟะพะทะธัะธะธ

- **ะะตัะพะดั ัะฐััะตัะฐ:**
  - `calculate_trading_fee()` - ัะฐััะตั ะบะพะผะธััะธะธ ะทะฐ ัะดะตะปะบั
  - ะะพะดะดะตัะถะบะฐ maker/taker ะบะพะผะธััะธะน
  - ะะฒัะพะผะฐัะธัะตัะบะพะต ะฒััะธัะฐะฝะธะต ะบะพะผะธััะธะน ะธะท PnL

**ะัะธะผะตั:**
```python
# ะะพะทะธัะธั ะฝะฐ $1000
# ะะพะผะธััะธั ะฒัะพะดะฐ: $1000 * 0.06% = $0.60
# ะะพะผะธััะธั ะฒััะพะดะฐ: $1000 * 0.06% = $0.60
# ะัะพะณะพ ะบะพะผะธััะธะน: $1.20
# PnL ั ััะตัะพะผ ะบะพะผะธััะธะน = gross_pnl - $1.20
```

#### 2. **ะะพะดะตะปะธัะพะฒะฐะฝะธะต Slippage** โ

ะะตะฐะปะธะทะพะฒะฐะฝะพ ะฟัะพัะบะฐะปัะทัะฒะฐะฝะธะต ัะตะฝั:

- **ะะฐัััะพะนะบะธ:**
  - `slippage_percent`: 0.05% (ะฝะฐัััะฐะธะฒะฐะตะผัะน ะฟะฐัะฐะผะตัั)
  - `use_slippage_in_backtest`: ะฒะบะปััะตะฝะธะต/ะฒัะบะปััะตะฝะธะต slippage

- **ะะพะณะธะบะฐ ะฟัะธะผะตะฝะตะฝะธั:**
  - ะัะธ ะฟะพะบัะฟะบะต (BUY): ัะตะฝะฐ ัะฒะตะปะธัะธะฒะฐะตััั ะฝะฐ slippage%
  - ะัะธ ะฟัะพะดะฐะถะต (SELL): ัะตะฝะฐ ัะผะตะฝััะฐะตััั ะฝะฐ slippage%
  - ะัะธะผะตะฝัะตััั ะบะฐะบ ะฟัะธ ะฒัะพะดะต, ัะฐะบ ะธ ะฟัะธ ะฒััะพะดะต ะธะท ะฟะพะทะธัะธะธ

- **ะะตัะพะด:** `apply_slippage(price, side)` ะฒ `VirtualTradingBot`

**ะัะธะผะตั:**
```python
# ะะฐะทะพะฒะฐั ัะตะฝะฐ: $43,000
# BUY ั slippage 0.05%: $43,021.50 (ะฟะพะบัะฟะฐะตะผ ะดะพัะพะถะต)
# SELL ั slippage 0.05%: $42,978.50 (ะฟัะพะดะฐะตะผ ะดะตัะตะฒะปะต)
```

#### 3. **ะะฝัะตะณัะฐัะธั ะฒ ัะพัะณะพะฒัะต ะผะตัะพะดั** โ

ะะฑะฝะพะฒะปะตะฝั ะฒัะต ะบะปััะตะฒัะต ะผะตัะพะดั:

- `_execute_virtual_buy()` - ััะตั ะบะพะผะธััะธะน ะธ slippage ะฟัะธ ะพัะบัััะธะธ long
- `_execute_virtual_sell()` - ััะตั ะบะพะผะธััะธะน ะธ slippage ะฟัะธ ะพัะบัััะธะธ short
- `_close_virtual_position()` - ััะตั ะบะพะผะธััะธะน ะธ slippage ะฟัะธ ะทะฐะบัััะธะธ
- ะะตัะฐะปัะฝะพะต ะปะพะณะธัะพะฒะฐะฝะธะต ะฒัะตั ะพะฟะตัะฐัะธะน

**ะัะธะผะตั ะปะพะณะพะฒ:**
```
๐ฏ ะัะฟะพะปะฝัะตะผ ะะะะขะฃะะะฌะะซะ BUY ัะธะณะฝะฐะป ะดะปั BTCUSDT
   ๐ซ Slippage: +0.050% (ัะตะฝะฐ: $43000.00 โ $43021.50)
   ๐ธ ะะพะผะธััะธั ะฒัะพะดะฐ: $0.6000 (0.060%)
```

#### 4. **ะะฑะฝะพะฒะปะตะฝะฝะฐั ััะฐัะธััะธะบะฐ** โ

ะะตัะพะด `get_virtual_trade_stats()` ัะตะฟะตัั ะฒะบะปััะฐะตั:

- `total_fees_paid` - ะพะฑัะฐั ััะผะผะฐ ะบะพะผะธััะธะน
- `total_entry_fees` - ััะผะผะฐ ะบะพะผะธััะธะน ะฟัะธ ะฒัะพะดะต
- `total_exit_fees` - ััะผะผะฐ ะบะพะผะธััะธะน ะฟัะธ ะฒััะพะดะต
- `total_profit` - ะพะฑัะฐั ะฟัะธะฑัะปั (ะดะปั Profit Factor)
- `total_loss` - ะพะฑัะธะต ัะฑััะบะธ (ะดะปั Profit Factor)

#### 5. **ะฃะปัััะตะฝะฝัะต ะผะตััะธะบะธ** โ

- **Profit Factor:** ัะตะฟะตัั ะธัะฟะพะปัะทัะตั ัะตะฐะปัะฝัะต ััะผะผั ะฟัะธะฑัะปะธ ะธ ัะฑััะบะพะฒ
- **ะััะตัั ะฑัะบัะตััะฐ:** ะฒะบะปััะฐัั ะดะตัะฐะปัะฝัั ะธะฝัะพัะผะฐัะธั ะพ ะบะพะผะธััะธัั
- **ะะปะธัะฝะธะต ะฝะฐ ะฑะฐะปะฐะฝั:** ะฟะพะบะฐะทัะฒะฐะตััั ะฟัะพัะตะฝัะฝะพะต ะฒะปะธัะฝะธะต ะบะพะผะธััะธะน

**ะัะธะผะตั ะพััะตัะฐ:**
```
๐ธ ะะพะผะธััะธะธ:
   ะัะตะณะพ ะบะพะผะธััะธะน: $12.4560
   ะะพะผะธััะธะธ ะฒัะพะดะฐ: $6.2280
   ะะพะผะธััะธะธ ะฒััะพะดะฐ: $6.2280
   ะะปะธัะฝะธะต ะฝะฐ ะฑะฐะปะฐะฝั: 0.125%
```

#### 6. **ะขะตััะพะฒัะน ัะบัะธะฟั** โ

ะกะพะทะดะฐะฝ `test_fees_slippage.py` ะดะปั ััะฐะฒะฝะตะฝะธั:
- ะะดะตะฐะปัะฝัะต ััะปะพะฒะธั (ะฑะตะท ะบะพะผะธััะธะน ะธ slippage)
- ะะตะฐะปะธััะธัะฝัะต ััะปะพะฒะธั (ั ะบะพะผะธััะธัะผะธ ะธ slippage)
- ะะฐััะตั ะฒะปะธัะฝะธั ะฝะฐ ัะตะทัะปััะฐัั

**ะะฐะฟััะบ:**
```bash
python src/test_fees_slippage.py
```

### ะขะตัะฝะธัะตัะบะธะต ะดะตัะฐะปะธ:

**ะะธะณัะฐัะธั ะะ:**
- ะะฒัะพะผะฐัะธัะตัะบะพะต ะดะพะฑะฐะฒะปะตะฝะธะต ะบะพะปะพะฝะพะบ `entry_fee`, `exit_fee`, `total_fees`
- ะกะพะฒะผะตััะธะผะพััั ั PostgreSQL ะธ SQLite
- ะะตะทะพะฟะฐัะฝะฐั ะผะธะณัะฐัะธั ะดะปั ัััะตััะฒัััะธั ะฑะฐะท

**ะคะพัะผัะปั ัะฐััะตัะฐ:**

```python
# ะะพะผะธััะธั
fee = position_value * (fee_percent / 100)

# Slippage
if side == 'BUY':
    price_with_slippage = price * (1 + slippage_percent / 100)
else:  # SELL
    price_with_slippage = price * (1 - slippage_percent / 100)

# PnL ั ะบะพะผะธััะธัะผะธ
pnl_net = pnl_gross - entry_fee - exit_fee
```

### ะะปะธัะฝะธะต ะฝะฐ ัะตะทัะปััะฐัั:

ะะฐ ะพัะฝะพะฒะต ัะตััะพะฒ ั ัะตะฐะปัะฝัะผะธ ะดะฐะฝะฝัะผะธ Bybit:

- **ะะพะผะธััะธะธ:** ัะฝะธะถะฐัั ROI ะฝะฐ ~0.12-0.24% ะทะฐ ัะดะตะปะบั
- **Slippage:** ัะฝะธะถะฐะตั ROI ะฝะฐ ~0.05-0.10% ะทะฐ ัะดะตะปะบั  
- **ะกัะผะผะฐัะฝะพะต ะฒะปะธัะฝะธะต:** ~0.17-0.34% ะทะฐ full round trip (ะฒัะพะด + ะฒััะพะด)

ะะปั ัััะฐัะตะณะธะธ ั 50 ัะดะตะปะบะฐะผะธ ะทะฐ ะผะตััั:
- ะะพัะตัะธ ะพั ะบะพะผะธััะธะน: ~6-12% ะณะพะดะพะฒัั
- ะญัะพ ะบัะธัะธัะตัะบะธ ะฒะฐะถะฝะพ ััะธััะฒะฐัั!

---

## โ Task 4.4: ะัะพะดะฒะธะฝัััะต ะผะตััะธะบะธ - ะะะะะะจะะะ

### ะะตะฐะปะธะทะพะฒะฐะฝะพ:

#### 1. **ะััะพัะธั ะฑะฐะปะฐะฝัะฐ** โ

ะะพะฑะฐะฒะปะตะฝะพ ะพััะปะตะถะธะฒะฐะฝะธะต ะฑะฐะปะฐะฝัะฐ ะฝะฐ ะบะฐะถะดะพะผ ัะฐะณะต ัะธะผัะปััะธะธ:

- **`balance_history`** - ัะฟะธัะพะบ ั timestamp ะธ ะฑะฐะปะฐะฝัะพะผ
- ะะฐะฟะธัั ะฟัะพะธััะพะดะธั ะฟะพัะปะต ะพะฑัะฐะฑะพัะบะธ ะบะฐะถะดะพะน ัะฒะตัะธ
- ะัะฟะพะปัะทัะตััั ะดะปั ัะฐััะตัะฐ ะฒัะตั ัะธัะบ-ะผะตััะธะบ

**ะกัััะบัััะฐ:**
```python
balance_history = [
    {'timestamp': 1733500800000, 'datetime': datetime(...), 'balance': 10050.25},
    {'timestamp': 1733501700000, 'datetime': datetime(...), 'balance': 10075.50},
    ...
]
```

#### 2. **Sharpe Ratio (ะะพัััะธัะธะตะฝั ะจะฐัะฟะฐ)** โ

ะัะฐะฒะธะปัะฝะฐั ัะตะฐะปะธะทะฐัะธั ั ะฐะฝะฝัะฐะปะธะทะฐัะธะตะน:

**ะคะพัะผัะปะฐ:**
```python
Sharpe = (Mean Return - Risk Free Rate) / Std Dev of Returns
Annualized Sharpe = Sharpe * sqrt(periods_per_year)
```

**ะัะพะฑะตะฝะฝะพััะธ:**
- ะะฒัะพะผะฐัะธัะตัะบะพะต ะพะฟัะตะดะตะปะตะฝะธะต ะบะพะปะธัะตััะฒะฐ ะฟะตัะธะพะดะพะฒ ะฒ ะณะพะด
- ะะพะดะดะตัะถะบะฐ ะฑะตะทัะธัะบะพะฒะพะน ััะฐะฒะบะธ (ะฟะพ ัะผะพะปัะฐะฝะธั 0%)
- ะะฝะฝัะฐะปะธะทะธัะพะฒะฐะฝะฝะพะต ะทะฝะฐัะตะฝะธะต ะดะปั ััะฐะฒะฝะตะฝะธั

**ะะฝัะตัะฟัะตัะฐัะธั:**
- `> 3.0` - ๐ ะัะปะธัะฝะพ (ะฟัะพัะตััะธะพะฝะฐะปัะฝัะน ััะพะฒะตะฝั)
- `2.0-3.0` - โ ะัะตะฝั ัะพัะพัะพ
- `1.0-2.0` - ๐ ะฅะพัะพัะพ
- `0.5-1.0` - ๐ก ะัะธะตะผะปะตะผะพ
- `< 0.5` - ๐ด ะะปะพัะพ

#### 3. **Sortino Ratio (ะะพัััะธัะธะตะฝั ะกะพััะธะฝะพ)** โ

ะฃะปัััะตะฝะฝะฐั ะฒะตััะธั Sharpe ั ััะตัะพะผ ัะพะปัะบะพ ะฝะตะณะฐัะธะฒะฝะพะน ะฒะพะปะฐัะธะปัะฝะพััะธ:

**ะคะพัะผัะปะฐ:**
```python
Sortino = (Mean Return - Target Return) / Downside Deviation
ะณะดะต Downside Deviation = sqrt(mean((negative_returns)^2))
```

**ะัะตะธะผััะตััะฒะฐ:**
- ะฃัะธััะฒะฐะตั ัะพะปัะบะพ ัะฑััะพัะฝัะต ะฟะตัะธะพะดั
- ะะพะปะตะต ัะพัะฝะฐั ะพัะตะฝะบะฐ ะดะปั ะฐัะธะผะผะตััะธัะฝัั ัััะฐัะตะณะธะน
- ะะฑััะฝะพ ะฒััะต Sharpe Ratio

**ะะพะณะดะฐ ะธัะฟะพะปัะทะพะฒะฐัั:**
- ะกััะฐัะตะณะธะธ ั ะฐัะธะผะผะตััะธัะฝัะผ ัะฐัะฟัะตะดะตะปะตะฝะธะตะผ ะดะพัะพะดะฝะพััะธ
- ะะพะณะดะฐ ะฒะฐะถะฝะฐ ะทะฐัะธัะฐ ะพั ะฟัะพัะฐะดะพะบ
- ะะปั ััะฐะฒะฝะตะฝะธั ะทะฐัะธัะฝัั ัััะฐัะตะณะธะน

#### 4. **Calmar Ratio (ะะพัััะธัะธะตะฝั ะะฐะปัะผะฐัะฐ)** โ

ะกะพะพัะฝะพัะตะฝะธะต ะดะพัะพะดะฝะพััะธ ะบ ะผะฐะบัะธะผะฐะปัะฝะพะน ะฟัะพัะฐะดะบะต:

**ะคะพัะผัะปะฐ:**
```python
Calmar = Annualized Return / Max Drawdown
```

**ะะฝัะตัะฟัะตัะฐัะธั:**
- `> 3.0` - ะัะปะธัะฝะพ
- `1.0-3.0` - ะฅะพัะพัะพ
- `< 1.0` - ะะธัะบ ะฟัะตะฒััะฐะตั ะดะพัะพะดะฝะพััั

**ะะพะณะดะฐ ะฒะฐะถะฝะพ:**
- ะะปั ะพัะตะฝะบะธ ัััะฐัะตะณะธะน ั ะฑะพะปััะธะผะธ ะฟัะพัะฐะดะบะฐะผะธ
- ะกัะฐะฒะฝะตะฝะธะต ะฐะณัะตััะธะฒะฝัั ัััะฐัะตะณะธะน
- ะะปะฐะฝะธัะพะฒะฐะฝะธะต ัะธัะบ-ะผะตะฝะตะดะถะผะตะฝัะฐ

#### 5. **Expectancy (ะะฐัะตะผะฐัะธัะตัะบะพะต ะพะถะธะดะฐะฝะธะต)** โ

ะะถะธะดะฐะตะผะฐั ะฟัะธะฑัะปั ะฝะฐ ะพะดะฝั ัะดะตะปะบั:

**ะคะพัะผัะปะฐ:**
```python
Expectancy = (Win Rate ร Avg Win) - (Loss Rate ร Avg Loss)
```

**ะัะธะผะตั:**
```python
Win Rate: 60%
Avg Win: $50
Loss Rate: 40%
Avg Loss: $30

Expectancy = (0.6 ร $50) - (0.4 ร $30) = $30 - $12 = $18
```

**ะัะฟะพะปัะทะพะฒะฐะฝะธะต:**
- ะัะตะฝะบะฐ ะดะพะปะณะพััะพัะฝะพะน ะฟัะธะฑัะปัะฝะพััะธ
- ะะฐััะตั ะพะฟัะธะผะฐะปัะฝะพะณะพ ัะฐะทะผะตัะฐ ะฟะพะทะธัะธะธ
- ะกัะฐะฒะฝะตะฝะธะต ัััะฐัะตะณะธะน

#### 6. **Average Trade Duration** โ

ะกัะตะดะฝัั ะฟัะพะดะพะปะถะธัะตะปัะฝะพััั ัะดะตะปะบะธ:

**ะะฐััะตั:**
- ะะตัะตััั ะฒัะตะผั ะพั ะพัะบัััะธั ะดะพ ะทะฐะบัััะธั ะฟะพะทะธัะธะธ
- ะััะธัะปัะตััั ััะตะดะฝะตะต ะฟะพ ะฒัะตะผ ะทะฐะบััััะผ ะฟะพะทะธัะธัะผ
- ะัะพะฑัะฐะถะฐะตััั ะฒ ัะฐัะฐั/ะดะฝัั

**ะะปะฐััะธัะธะบะฐัะธั:**
- `< 1 ัะฐั` - ะกะบะฐะปัะฟะธะฝะณ
- `1-24 ัะฐัะฐ` - ะะฝะตะฒะฝะฐั ัะพัะณะพะฒะปั (day trading)
- `> 24 ัะฐัะพะฒ` - ะกะฒะธะฝะณ-ััะตะนะดะธะฝะณ

**ะะพัะตะผั ะฒะฐะถะฝะพ:**
- ะะฟัะตะดะตะปะตะฝะธะต ััะธะปั ัััะฐัะตะณะธะธ
- ะัะตะฝะบะฐ ะฒะปะธัะฝะธั ะบะพะผะธััะธะน
- ะะปะฐะฝะธัะพะฒะฐะฝะธะต ะฒัะตะผะตะฝะธ ะดะปั ัะพัะณะพะฒะปะธ

#### 7. **ะฃะปัััะตะฝะฝัะน Profit Factor** โ

ะขะตะฟะตัั ะธัะฟะพะปัะทัะตั ัะตะฐะปัะฝัะต ััะผะผั ะฟัะธะฑัะปะตะน ะธ ัะฑััะบะพะฒ:

**ะคะพัะผัะปะฐ:**
```python
Profit Factor = Sum(All Winning Trades) / Sum(All Losing Trades)
```

**ะะฝัะตัะฟัะตัะฐัะธั:**
- `> 2.0` - ๐ ะัะปะธัะฝะพ
- `1.5-2.0` - โ ะฅะพัะพัะพ
- `1.0-1.5` - ๐ก ะัะธะตะผะปะตะผะพ
- `< 1.0` - ๐ด ะฃะฑััะพัะฝะพ

#### 8. **ะะฐััะธัะตะฝะฝัะต ะพััะตัั** โ

ะะฑะฝะพะฒะปะตะฝั ะพััะตัั ะฑัะบัะตััะธะฝะณะฐ:

```
๐ ะะธัะบ-ัะบะพััะตะบัะธัะพะฒะฐะฝะฝัะต ะผะตััะธะบะธ:
   Sharpe Ratio: 1.856 โ ะัะตะฝั ัะพัะพัะพ
   Sortino Ratio: 2.134
   Calmar Ratio: 1.425

๐น ะขะพัะณะพะฒัะต ะผะตััะธะบะธ:
   Profit Factor: 2.15
   Expectancy: $12.45 ะฝะฐ ัะดะตะปะบั
   ะกัะตะดะฝัั ะดะปะธัะตะปัะฝะพััั ัะดะตะปะบะธ: 4.2 ัะฐัะฐ
```

#### 9. **ะขะตััะพะฒัะน ัะบัะธะฟั** โ

ะกะพะทะดะฐะฝ `test_advanced_metrics.py`:
- ะะพะดัะพะฑะฝะพะต ะพะฑัััะฝะตะฝะธะต ะบะฐะถะดะพะน ะผะตััะธะบะธ
- ะะฐะฟััะบ ะฑัะบัะตััะฐ ั ะผะตััะธะบะฐะผะธ
- ะะตัะฐะปัะฝัะน ะฐะฝะฐะปะธะท ัะตะทัะปััะฐัะพะฒ
- ะัะพะณะพะฒะฐั ะพัะตะฝะบะฐ ัััะฐัะตะณะธะธ (ะฑะฐะปะปัะฝะฐั ัะธััะตะผะฐ)

**ะะฐะฟััะบ:**
```bash
python src/test_advanced_metrics.py
```

### ะขะตัะฝะธัะตัะบะธะต ะดะตัะฐะปะธ:

**ะะฐะฒะธัะธะผะพััะธ:**
- ะะพะฑะฐะฒะปะตะฝ `numpy` ะดะปั ััะฐัะธััะธัะตัะบะธั ัะฐััะตัะพะฒ
- ะกะพะฒะผะตััะธะผะพััั ั Python 3.9+

**ะัะพะธะทะฒะพะดะธัะตะปัะฝะพััั:**
- ะะธะฝะธะผะฐะปัะฝะพะต ะฒะปะธัะฝะธะต ะฝะฐ ัะบะพัะพััั ะฑัะบัะตััะฐ
- ะััะพัะธั ะฑะฐะปะฐะฝัะฐ ะทะฐะฝะธะผะฐะตั ~0.1-1 ะะ ะฟะฐะผััะธ ะฝะฐ ะฑัะบัะตัั

**ะขะพัะฝะพััั ัะฐััะตัะพะฒ:**
- ะัะฟะพะปัะทัะตััั ะฒัะฑะพัะพัะฝะพะต ััะฐะฝะดะฐััะฝะพะต ะพัะบะปะพะฝะตะฝะธะต (ddof=1)
- ะะฝะฝัะฐะปะธะทะฐัะธั ั ััะตัะพะผ ัะฐะบัะธัะตัะบะพะณะพ ัะธัะปะฐ ะฟะตัะธะพะดะพะฒ
- ะะพััะตะบัะฝะฐั ะพะฑัะฐะฑะพัะบะฐ ะบัะฐะตะฒัั ัะปััะฐะตะฒ (ะฝะตั ะดะฐะฝะฝัั, ะฝะตั ัะฑััะบะพะฒ ะธ ั.ะด.)

### ะัะธะผะตัั ะธัะฟะพะปัะทะพะฒะฐะฝะธั:

```python
from backtester import BacktestEngine
from datetime import datetime, timedelta

engine = BacktestEngine()

results = engine.run_backtest(
    symbols=['BTCUSDT', 'ETHUSDT'],
    interval='15',
    start_date=datetime.now() - timedelta(days=30),
    end_date=datetime.now(),
    initial_balance=10000.0
)

# ะะพัััะฟ ะบ ะผะตััะธะบะฐะผ
print(f"Sharpe Ratio: {results['sharpe_ratio']:.3f}")
print(f"Sortino Ratio: {results['sortino_ratio']:.3f}")
print(f"Calmar Ratio: {results['calmar_ratio']:.3f}")
print(f"Expectancy: ${results['expectancy']:.2f}")
print(f"Avg Duration: {results['avg_trade_duration_hours']:.1f} hours")
```

## โ Task 4.5: Web UI - ะะะะะะจะะะ

### ะะตะฐะปะธะทะพะฒะฐะฝะพ:

#### 1. **Flask Backend** (`src/web/app.py`) โ

ะะพะปะฝะพัะตะฝะฝัะน ะฒะตะฑ-ัะตัะฒะตั ั REST API:

**ะัะฝะพะฒะฝัะต endpoints:**
- `GET /` - ะณะปะฐะฒะฝะฐั ัััะฐะฝะธัะฐ
- `POST /api/run_backtest` - ะทะฐะฟััะบ ะฑัะบัะตััะฐ
- `GET /api/chart_data/balance` - ะดะฐะฝะฝัะต ะดะปั ะณัะฐัะธะบะฐ ะฑะฐะปะฐะฝัะฐ
- `GET /api/chart_data/drawdown` - ะดะฐะฝะฝัะต ะดะปั ะณัะฐัะธะบะฐ ะฟัะพัะฐะดะบะธ
- `GET /api/chart_data/pnl_distribution` - ัะฐัะฟัะตะดะตะปะตะฝะธะต PnL
- `GET /api/settings` - ัะตะบััะธะต ะฝะฐัััะพะนะบะธ ะธะท ะะ

**ะัะพะฑะตะฝะฝะพััะธ:**
- ะัะธะฝััะพะฝะฝะฐั ะพะฑัะฐะฑะพัะบะฐ ะทะฐะฟัะพัะพะฒ
- ะะตัะธัะพะฒะฐะฝะธะต ะฟะพัะปะตะดะฝะธั ัะตะทัะปััะฐัะพะฒ
- ะะตัะฐะปัะฝะฐั ะพะฑัะฐะฑะพัะบะฐ ะพัะธะฑะพะบ
- ะะพะณะธัะพะฒะฐะฝะธะต ะฒัะตั ะพะฟะตัะฐัะธะน

#### 2. **Frontend UI** (`src/web/templates/index.html`) โ

ะกะพะฒัะตะผะตะฝะฝัะน ะฒะตะฑ-ะธะฝัะตััะตะนั ั:

**ะะธะทะฐะนะฝ:**
- Tailwind CSS ะดะปั ััะธะปะธะทะฐัะธะธ
- Gradient header
- Responsive layout (ะฐะดะฐะฟัะธะฒะฝัะน)
- Card-based ะผะตััะธะบะธ
- Font Awesome ะธะบะพะฝะบะธ

**ะะฐะฝะตะปั ัะฟัะฐะฒะปะตะฝะธั:**
- ะัะฑะพั ัะธะผะฒะพะปะพะฒ
- ะขะฐะนะผััะตะนะผ (ะพั 1 ะผะธะฝััั ะดะพ 1 ะดะฝั)
- ะะตัะธะพะด ัะตััะธัะพะฒะฐะฝะธั (1-90 ะดะฝะตะน)
- ะะฐัะฐะปัะฝัะน ะฑะฐะปะฐะฝั
- ะะฟัะธะธ ะบะพะผะธััะธะน ะธ slippage

**ะัะพะฑัะฐะถะตะฝะธะต ะผะตััะธะบ:**
- 4 ะพัะฝะพะฒะฝัะต ะผะตััะธะบะธ (ะบััะฟะฝะพ)
- 6 ะฟัะพะดะฒะธะฝัััั ะผะตััะธะบ
- ะฆะฒะตัะพะฒะฐั ะธะฝะดะธะบะฐัะธั (ะทะตะปะตะฝัะน/ะถะตะปััะน/ะบัะฐัะฝัะน)

#### 3. **ะะฝัะตัะฐะบัะธะฒะฝัะต ะณัะฐัะธะบะธ** (Chart.js) โ

**ะัะฐัะธะบ 1: Equity Curve (ะะฐะปะฐะฝั)**
- Line chart ั ะฟะปะฐะฒะฝัะผะธ ะบัะธะฒัะผะธ
- ะะฐัะฐะปัะฝะฐั ะปะธะฝะธั ะฑะฐะปะฐะฝัะฐ (ะฟัะฝะบัะธั)
- ะัะฐะดะธะตะฝัะฝะฐั ะทะฐะปะธะฒะบะฐ
- Tooltip ั ะดะตัะฐะปัะผะธ

```javascript
// ะัะธะผะตั ะดะฐะฝะฝัั
{
  labels: ['2025-12-01 12:00', '2025-12-01 12:15', ...],
  datasets: [
    {label: 'ะะฐะปะฐะฝั ($)', data: [10000, 10050, 10120, ...]},
    {label: 'ะะฐัะฐะปัะฝัะน ะฑะฐะปะฐะฝั', data: [10000, 10000, ...]}
  ]
}
```

**ะัะฐัะธะบ 2: Drawdown (ะัะพัะฐะดะบะฐ)**
- ะะพะบะฐะทัะฒะฐะตั ะฟัะพัะฐะดะบั ะพั ะฟะธะบะฐ ะฒ %
- ะะฑัะฐัะฝะฐั Y-ะพัั (ะฒะฝะธะท = ััะถะต)
- ะัะฐัะฝะฐั ะทะฐะปะธะฒะบะฐ ะดะปั ะฝะฐะณะปัะดะฝะพััะธ
- ะะฑะฝะพะฒะปัะตััั ะฒ ัะตะฐะปัะฝะพะผ ะฒัะตะผะตะฝะธ

**ะัะฐัะธะบ 3: PnL Distribution (ะะฐัะฟัะตะดะตะปะตะฝะธะต)**
- Bar chart ะดะปั ะบะฐะถะดะพะน ัะดะตะปะบะธ
- ะะตะปะตะฝัะต ััะพะปะฑัั - ะฟัะธะฑัะปั
- ะัะฐัะฝัะต ััะพะปะฑัั - ัะฑััะพะบ
- Tooltip ั ะดะตัะฐะปัะผะธ ัะดะตะปะบะธ (ัะธะผะฒะพะป, ะฝะฐะฟัะฐะฒะปะตะฝะธะต)

#### 4. **JavaScript Logic** (`src/web/static/js/main.js`) โ

**ะคัะฝะบัะธะพะฝะฐะปัะฝะพััั:**
- ะัะฟัะฐะฒะบะฐ ัะพัะผ ัะตัะตะท AJAX
- ะะธะฝะฐะผะธัะตัะบะพะต ะพะฑะฝะพะฒะปะตะฝะธะต ะผะตััะธะบ
- ะกะพะทะดะฐะฝะธะต ะธ ะพะฑะฝะพะฒะปะตะฝะธะต ะณัะฐัะธะบะพะฒ
- ะฆะฒะตัะพะฒะฐั ะธะฝะดะธะบะฐัะธั ะบะฐัะตััะฒะฐ ะผะตััะธะบ
- ะะฑัะฐะฑะพัะบะฐ ะพัะธะฑะพะบ

**ะฆะฒะตัะพะฒะฐั ัะธััะตะผะฐ:**
```javascript
Sharpe Ratio > 2.0: ะทะตะปะตะฝัะน (ะพัะปะธัะฝะพ)
Sharpe Ratio 1.0-2.0: ะถะตะปััะน (ัะพัะพัะพ)
Sharpe Ratio < 1.0: ะบัะฐัะฝัะน (ะฟะปะพัะพ)
```

**ะะฒัะพะผะฐัะธัะตัะบะธะต ััะฝะบัะธะธ:**
- ะะฐะณััะทะบะฐ ะฝะฐัััะพะตะบ ะธะท ะะ ะฟัะธ ััะฐััะต
- ะคะพัะผะฐัะธัะพะฒะฐะฝะธะต ัะธัะตะป ($ ะธ %)
- ะะดะฐะฟัะธะฒะฝะพะต ะพัะพะฑัะฐะถะตะฝะธะต ะดะปะธัะตะปัะฝะพััะธ (ะผะธะฝััั/ัะฐัั/ะดะฝะธ)

#### 5. **User Experience** โ

**ะะฝะดะธะบะฐัะธั ะฟัะพัะตััะฐ:**
```
ะะฐะฟััะบ โ ะะฝะดะธะบะฐัะพั ะทะฐะณััะทะบะธ โ ะะตะทัะปััะฐัั + ะัะฐัะธะบะธ
```

**ะะฝัะตัะฐะบัะธะฒะฝะพััั:**
- Hover effects ะฝะฐ ะบะฐััะพัะบะฐั
- ะะฝะธะผะฐัะธะธ ะฟะตัะตัะพะดะพะฒ
- Responsive ะดะธะทะฐะนะฝ (ะผะพะฑะธะปัะฝัะต ััััะพะนััะฒะฐ)
- ะฃะดะพะฑะฝะฐั ะฝะฐะฒะธะณะฐัะธั

**ะะฐะปะธะดะฐัะธั:**
- ะะธะฝะธะผะฐะปัะฝัะต ะทะฝะฐัะตะฝะธั ะดะปั ะฒัะตั ะฟะพะปะตะน
- ะะพััะตะบัะฝัะน ัะพัะผะฐั ัะธะผะฒะพะปะพะฒ
- ะัะพะฒะตัะบะฐ ะฟะตัะตะด ะพัะฟัะฐะฒะบะพะน

---

## ๐จ ะขะตัะฝะธัะตัะบะธะน ััะตะบ Web UI

**Backend:**
- Flask 3.0+ (Python web framework)
- REST API ะฐััะธัะตะบัััะฐ
- JSON ะดะปั ะพะฑะผะตะฝะฐ ะดะฐะฝะฝัะผะธ

**Frontend:**
- HTML5
- Tailwind CSS 3.x (utility-first CSS)
- Chart.js 4.x (ะณัะฐัะธะบะธ)
- Vanilla JavaScript (ะฑะตะท ััะตะนะผะฒะพัะบะพะฒ)

**ะะบะพะฝะบะธ:**
- Font Awesome 6.x

**ะัะตะธะผััะตััะฒะฐ ะฒัะฑัะฐะฝะฝะพะณะพ ััะตะบะฐ:**
- โ ะะตะณะบะพะฒะตัะฝัะน (ะฝะต ััะตะฑัะตั npm/node.js)
- โ ะััััะฐั ัะฐะทัะฐะฑะพัะบะฐ (Tailwind CDN)
- โ ะัะพััะฑัะฐัะทะตัะฝะพััั
- โ ะะธะฝะธะผัะผ ะทะฐะฒะธัะธะผะพััะตะน

---

## ๐ฆ ะกัััะบัััะฐ ะดะธัะตะบัะพัะธะน

```
src/web/
โโโ app.py                  # Flask ะฟัะธะปะพะถะตะฝะธะต
โโโ templates/
โ   โโโ index.html         # ะะปะฐะฒะฝะฐั ัััะฐะฝะธัะฐ
โโโ static/
    โโโ css/               # (ะฟะพะบะฐ ะฝะต ะธัะฟะพะปัะทัะตััั - Tailwind CDN)
    โโโ js/
        โโโ main.js        # JavaScript ะปะพะณะธะบะฐ
```

---

## ๐ ะะฐะฟััะบ Web UI

### ะะตัะพะด 1: ะััะผะพะน ะทะฐะฟััะบ

```bash
python src/web/app.py
```

### ะะตัะพะด 2: ะะท ะปัะฑะพะน ะดะธัะตะบัะพัะธะธ

```bash
cd /path/to/crypto-trading-bot
python -m src.web.app
```

### ะะตัะพะด 3: Production (gunicorn)

```bash
pip install gunicorn
gunicorn -w 4 -b 0.0.0.0:5000 src.web.app:app
```

**ะะพัะปะต ะทะฐะฟััะบะฐ:**
```
๐ ะัะบัะพะนัะต: http://localhost:5000
```

---

## ๐ ะัะธะผะตัั ะธัะฟะพะปัะทะพะฒะฐะฝะธั

### ะัะธะผะตั 1: ะัััััะน ัะตัั

1. ะะฐะฟัััะธัะต `python src/web/app.py`
2. ะัะบัะพะนัะต http://localhost:5000
3. ะััะฐะฒััะต ะฝะฐัััะพะนะบะธ ะฟะพ ัะผะพะปัะฐะฝะธั
4. ะะฐะถะผะธัะต "ะะฐะฟัััะธัั ะฑัะบัะตัั"
5. ะะพะดะพะถะดะธัะต 30-60 ัะตะบัะฝะด
6. ะะทััะธัะต ัะตะทัะปััะฐัั ะธ ะณัะฐัะธะบะธ

### ะัะธะผะตั 2: ะกัะฐะฒะฝะตะฝะธะต ัััะฐัะตะณะธะน

**ะขะตัั 1: ะก ะบะพะผะธััะธัะผะธ**
- ะฃััะฐะฝะพะฒะธัะต ะฒัะต ะณะฐะปะพัะบะธ
- ะะฐะฟัััะธัะต
- ะะฐะฟะธัะธัะต ROI

**ะขะตัั 2: ะะตะท ะบะพะผะธััะธะน**
- ะกะฝะธะผะธัะต ะณะฐะปะพัะบะธ
- ะะฐะฟัััะธัะต
- ะกัะฐะฒะฝะธัะต ROI

**ะะตะทัะปััะฐั:** ะฃะฒะธะดะธัะต ัะตะฐะปัะฝะพะต ะฒะปะธัะฝะธะต ะบะพะผะธััะธะน

---

## ๐ฏ Roadmap (ะฑัะดััะธะต ัะปัััะตะฝะธั)

### ะะปะฐะฝะธััะตััั:
- [ ] ะกะพััะฐะฝะตะฝะธะต ัะตะทัะปััะฐัะพะฒ ะฑัะบัะตััะพะฒ ะฒ ะะ
- [ ] ะกััะฐะฝะธัะฐ ะธััะพัะธะธ ะฑัะบัะตััะพะฒ
- [ ] ะกัะฐะฒะฝะตะฝะธะต ะฝะตัะบะพะปัะบะธั ะฑัะบัะตััะพะฒ
- [ ] ะญะบัะฟะพัั ะฒ PDF/HTML
- [ ] Heatmap ะดะพัะพะดะฝะพััะธ
- [ ] ะะฐัะฐะผะตััะธัะตัะบะฐั ะพะฟัะธะผะธะทะฐัะธั (grid search)
- [ ] Websockets ะดะปั ัะตะฐะปัะฝะพะณะพ ะฒัะตะผะตะฝะธ
- [ ] ะััะตะฝัะธัะธะบะฐัะธั ะฟะพะปัะทะพะฒะฐัะตะปะตะน
- [ ] ะขะตะผะฝะฐั ัะตะผะฐ

---

## ๐ ะะพะบัะผะตะฝัะฐัะธั

ะะพะดัะพะฑะฝะพะต ััะบะพะฒะพะดััะฒะพ: **[WEBUI_GUIDE.md](../WEBUI_GUIDE.md)**

---

## ๐ฏ ะกะปะตะดัััะธะต ัะฐะณะธ

### Task 4.3: ะะพะฟะพะปะฝะธัะตะปัะฝัะต ัะปัััะตะฝะธั (ะพะฟัะธะพะฝะฐะปัะฝะพ)
- [ ] ะะตะฐะปะธััะธัะฝะพะต ะธัะฟะพะปะฝะตะฝะธะต ะพัะดะตัะพะฒ (ะทะฐะดะตัะถะบะธ, ัะฐััะธัะฝะพะต ะทะฐะฟะพะปะฝะตะฝะธะต)
- [ ] ะฃัะตั ะปะธะบะฒะธะดะฝะพััะธ ััะฝะบะฐ
- [ ] ะะธะฝะฐะผะธัะตัะบะธะน slippage ะฒ ะทะฐะฒะธัะธะผะพััะธ ะพั ะพะฑัะตะผะฐ

### Task 4.5: Web UI โ ะะะะะะจะะะ
- [x] Flask ะฟัะธะปะพะถะตะฝะธะต ั REST API
- [x] ะะฝัะตัะฐะบัะธะฒะฝัะน ะฒะตะฑ-ะธะฝัะตััะตะนั (Tailwind CSS)
- [x] ะัะฐัะธะบ ะฑะฐะปะฐะฝัะฐ (Equity Curve)
- [x] ะัะฐัะธะบ ะฟัะพัะฐะดะบะธ (Drawdown)
- [x] ะะฐัะฟัะตะดะตะปะตะฝะธะต PnL ะฟะพ ัะดะตะปะบะฐะผ (ััะพะปะฑัะฐัะฐั ะดะธะฐะณัะฐะผะผะฐ)
- [x] ะัะพะฑัะฐะถะตะฝะธะต ะฒัะตั ะผะตััะธะบ (ะฑะฐะทะพะฒัะต + ะฟัะพะดะฒะธะฝัััะต)
- [x] ะฆะฒะตัะพะฒะฐั ะธะฝะดะธะบะฐัะธั ะบะฐัะตััะฒะฐ ะผะตััะธะบ
- [x] Chart.js ะดะปั ะธะฝัะตัะฐะบัะธะฒะฝัั ะณัะฐัะธะบะพะฒ
- [x] Responsive ะดะธะทะฐะนะฝ
- [x] ะะฒัะพะผะฐัะธัะตัะบะฐั ะทะฐะณััะทะบะฐ ะฝะฐัััะพะตะบ ะธะท ะะ
- [ ] Heatmap ะดะพัะพะดะฝะพััะธ (ะพะฟัะธะพะฝะฐะปัะฝะพ)
- [ ] ะญะบัะฟะพัั ะพััะตัะพะฒ ะฒ HTML/PDF (ะพะฟัะธะพะฝะฐะปัะฝะพ)

---

## ๐ก ะัะฟะพะปัะทะพะฒะฐะฝะธะต ะฒ ะฑัะบัะตััะต

### ะัะธะผะตั ะธะฝัะตะณัะฐัะธะธ:

```python
from data_loader import DataLoader
from datetime import datetime, timedelta

# ะะฝะธัะธะฐะปะธะทะฐัะธั
loader = DataLoader()

# ะะตัะธะพะด ัะตััะธัะพะฒะฐะฝะธั
start_date = datetime(2025, 11, 1)
end_date = datetime(2025, 12, 1)

# ะะฐะณััะทะบะฐ ะดะฐะฝะฝัั
symbols = ['BTCUSDT', 'ETHUSDT']
historical_data = loader.preload_data_for_backtest(
    symbols=symbols,
    interval='15',
    start_date=start_date,
    end_date=end_date
)

# ะขะตะฟะตัั ะผะพะถะฝะพ ะทะฐะฟััะบะฐัั ะฑัะบัะตัั
# for timestamp in timeline:
#     for symbol in symbols:
#         current_candle = get_candle_at_timestamp(historical_data[symbol], timestamp)
#         signal = strategy.get_signal(current_candle)
#         execute_trade(signal)
```

---

## ๐ ะัะตะธะผััะตััะฒะฐ ัะตะฐะปะธะทะฐัะธะธ

1. **ะัะพะธะทะฒะพะดะธัะตะปัะฝะพััั**
   - ะะตั ะฒ ะะ โ ะฑัััััะต ะฟะพะฒัะพัะฝัะต ะทะฐะฟััะบะธ ะฑัะบัะตััะพะฒ
   - ะะฝะดะตะบัั โ ะผะณะฝะพะฒะตะฝะฝัะน ะฟะพะธัะบ ะดะฐะฝะฝัั
   - ะะฐะณะธะฝะฐัะธั โ ะทะฐะณััะทะบะฐ ะฑะพะปััะธั ะฟะตัะธะพะดะพะฒ ะฑะตะท ะพะณัะฐะฝะธัะตะฝะธะน

2. **ะะฐะดะตะถะฝะพััั**
   - ะะฒัะพะผะฐัะธัะตัะบะฐั ะฟัะพะฒะตัะบะฐ ัะตะปะพััะฝะพััะธ ะดะฐะฝะฝัั
   - ะะฑัะฐะฑะพัะบะฐ ะพัะธะฑะพะบ API
   - Retry ะผะตัะฐะฝะธะทะผั

3. **ะฃะดะพะฑััะฒะพ**
   - ะัะพััะพะน API ะดะปั ะทะฐะณััะทะบะธ
   - ะะฒัะพะผะฐัะธัะตัะบะพะต ะบะตัะธัะพะฒะฐะฝะธะต
   - ะะตัะฐะปัะฝะพะต ะปะพะณะธัะพะฒะฐะฝะธะต

4. **ะะธะฑะบะพััั**
   - ะะพะดะดะตัะถะบะฐ ะปัะฑัั ัะฐะนะผััะตะนะผะพะฒ
   - ะะฐะฑะพัะฐ ั PostgreSQL ะธ SQLite
   - ะะตะณะบะพ ัะฐััะธััะตััั

---

## ๐ง ะขะตัะฝะธัะตัะบะธะต ะดะตัะฐะปะธ

### ะะณัะฐะฝะธัะตะฝะธั Bybit API:
- ะะฐะบัะธะผัะผ 1000 ัะฒะตัะตะน ะทะฐ ะทะฐะฟัะพั
- Rate limit: ~120 ะทะฐะฟัะพัะพะฒ/ะผะธะฝััั
- ะะตัะตะฝะพ: ะฐะฒัะพะผะฐัะธัะตัะบะฐั ะฟะฐะณะธะฝะฐัะธั ั ะทะฐะดะตัะถะบะฐะผะธ

### ะฅัะฐะฝะตะฝะธะต ะฒ ะะ:
- PostgreSQL: DECIMAL ะดะปั ัะพัะฝะพััะธ
- SQLite: REAL (ะฐะฒัะพะผะฐัะธัะตัะบะฐั ะบะพะฝะฒะตััะฐัะธั)
- ะฃะฝะธะบะฐะปัะฝะพััั: ัะพััะฐะฒะฝะพะน ะบะปัั (symbol, interval, timestamp)

### ะัะพะธะทะฒะพะดะธัะตะปัะฝะพััั:
- ~1-2 ัะตะบัะฝะดั ะฝะฐ ะทะฐะณััะทะบั 1000 ัะฒะตัะตะน ั API
- <100ะผั ะฝะฐ ะทะฐะณััะทะบั ะธะท ะบะตัะฐ ะะ
- ะะพะดะดะตัะถะบะฐ ะผะธะปะปะธะพะฝะพะฒ ะทะฐะฟะธัะตะน ะฒ ะบะตัะต

---

**ะะฒัะพั ัะตะฐะปะธะทะฐัะธะธ:** AI Assistant  
**ะะฐัะฐ:** 2025-12-06  
**ะะตััะธั:** 0.1.0-alpha

