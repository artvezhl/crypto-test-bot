# üìä –°–∏—Å—Ç–µ–º–∞ –±—ç–∫—Ç–µ—Å—Ç–∏–Ω–≥–∞ - –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

> **–í–µ—Ä—Å–∏—è:** 0.1.0-alpha  
> **–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ:** 2025-12-06  
> **–°—Ç–∞—Ç—É—Å:** –ë–∞–∑–æ–≤–∞—è –≤–µ—Ä—Å–∏—è –≥–æ—Ç–æ–≤–∞ –∫ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é

---

## üéØ –ß—Ç–æ —Ç–∞–∫–æ–µ –±—ç–∫—Ç–µ—Å—Ç–∏–Ω–≥?

**–ë—ç–∫—Ç–µ—Å—Ç–∏–Ω–≥** - —ç—Ç–æ –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ç–æ—Ä–≥–æ–≤–æ–π —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ –Ω–∞ –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏—Ö –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –æ—Ü–µ–Ω–∫–∏ –µ—ë —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –¥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —Ä–µ–∞–ª—å–Ω—ã—Ö –¥–µ–Ω–µ–≥.

### –ó–∞—á–µ–º —ç—Ç–æ –Ω—É–∂–Ω–æ?

- ‚úÖ **–ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏** –±–µ–∑ —Ä–∏—Å–∫–∞ –ø–æ—Ç–µ—Ä–∏ –¥–µ–Ω–µ–≥
- ‚úÖ **–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤** (stop-loss, take-profit, leverage)
- ‚úÖ **–û—Ü–µ–Ω–∫–∞ —Ä–∏—Å–∫–æ–≤** (Max Drawdown, Sharpe Ratio)
- ‚úÖ **–°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å—Ç—Ä–∞—Ç–µ–≥–∏–π** –∏ –≤—ã–±–æ—Ä –ª—É—á—à–µ–π

---

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### 1. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

```bash
# –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ –≤—Å–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã
pip install -r requirements.txt
```

### 2. –ó–∞–ø—É—Å–∫ –ø—Ä–æ—Å—Ç–æ–≥–æ –±—ç–∫—Ç–µ—Å—Ç–∞

```bash
# –ó–∞–ø—É—Å—Ç–∏—Ç—å —Ç–µ—Å—Ç–æ–≤—ã–π —Å–∫—Ä–∏–ø—Ç
python src/test_backtest.py
```

–≠—Ç–æ –∑–∞–ø—É—Å—Ç–∏—Ç –±—ç–∫—Ç–µ—Å—Ç –Ω–∞ –ø–æ—Å–ª–µ–¥–Ω–∏—Ö 7 –¥–Ω—è—Ö –¥–ª—è BTC –∏ ETH.

### 3. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π –±—ç–∫—Ç–µ—Å—Ç

```python
from backtester import BacktestEngine
from datetime import datetime, timedelta

# –°–æ–∑–¥–∞–µ–º –¥–≤–∏–∂–æ–∫
engine = BacktestEngine()

# –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º –ø–µ—Ä–∏–æ–¥
end_date = datetime.now()
start_date = end_date - timedelta(days=30)

# –ó–∞–ø—É—Å–∫–∞–µ–º
results = engine.run_backtest(
    symbols=['BTCUSDT', 'ETHUSDT', 'SOLUSDT'],
    interval='15',  # 15-–º–∏–Ω—É—Ç–Ω—ã–µ —Å–≤–µ—á–∏
    start_date=start_date,
    end_date=end_date,
    initial_balance=10000.0
)

# –ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
print(f"ROI: {results['roi_percent']:.2f}%")
print(f"Win Rate: {results['win_rate']:.2f}%")
print(f"Max Drawdown: {results['max_drawdown']:.2f}%")
```

---

## üìã –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å–∏—Å—Ç–µ–º—ã

### –û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã:

```
BacktestEngine (–Ω–∞—Å–ª–µ–¥—É–µ—Ç—Å—è –æ—Ç VirtualTradingBot)
    ‚îú‚îÄ‚îÄ DataLoader - –∑–∞–≥—Ä—É–∑–∫–∞ –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏—Ö –¥–∞–Ω–Ω—ã—Ö
    ‚îú‚îÄ‚îÄ Database - –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ —Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
    ‚îú‚îÄ‚îÄ DeepSeekClient - –ø–æ–ª—É—á–µ–Ω–∏–µ —Ç–æ—Ä–≥–æ–≤—ã—Ö —Å–∏–≥–Ω–∞–ª–æ–≤
    ‚îî‚îÄ‚îÄ BybitClient - –¥–∞–Ω–Ω—ã–µ —Å –±–∏—Ä–∂–∏
```

### –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç:

1. **–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö** - `DataLoader` –∑–∞–≥—Ä—É–∂–∞–µ—Ç –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏–µ —Å–≤–µ—á–∏
2. **–°–æ–∑–¥–∞–Ω–∏–µ timeline** - —Ñ–æ—Ä–º–∏—Ä—É–µ—Ç—Å—è –≤—Ä–µ–º–µ–Ω–Ω–∞—è —à–∫–∞–ª–∞
3. **–°–∏–º—É–ª—è—Ü–∏—è —Ç–æ—Ä–≥–æ–≤–ª–∏** - –¥–≤–∏–∂–æ–∫ –ø—Ä–æ—Ö–æ–¥–∏—Ç –ø–æ –∫–∞–∂–¥–æ–π —Å–≤–µ—á–µ –∏:
   - –û–±–Ω–æ–≤–ª—è–µ—Ç —Ü–µ–Ω—ã –ø–æ–∑–∏—Ü–∏–π
   - –ü—Ä–æ–≤–µ—Ä—è–µ—Ç stop-loss/take-profit
   - –ü–æ–ª—É—á–∞–µ—Ç —Å–∏–≥–Ω–∞–ª –æ—Ç AI
   - –û—Ç–∫—Ä—ã–≤–∞–µ—Ç/–∑–∞–∫—Ä—ã–≤–∞–µ—Ç –ø–æ–∑–∏—Ü–∏–∏
4. **–†–∞—Å—á–µ—Ç –º–µ—Ç—Ä–∏–∫** - –≤—ã—á–∏—Å–ª—è—é—Ç—Å—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
5. **–ì–µ–Ω–µ—Ä–∞—Ü–∏—è –æ—Ç—á–µ—Ç–∞** - –≤—ã–≤–æ–¥—è—Ç—Å—è –∏—Ç–æ–≥–∏

---

## üé® –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –ü—Ä–∏–º–µ—Ä 1: –ë–∞–∑–æ–≤—ã–π –±—ç–∫—Ç–µ—Å—Ç

```python
from backtester import BacktestEngine
from datetime import datetime, timedelta

engine = BacktestEngine()

results = engine.run_backtest(
    symbols=['BTCUSDT'],
    interval='60',  # 1-—á–∞—Å–æ–≤—ã–µ —Å–≤–µ—á–∏
    start_date=datetime.now() - timedelta(days=7),
    end_date=datetime.now(),
    initial_balance=10000.0
)
```

### –ü—Ä–∏–º–µ—Ä 2: –°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å—Ç—Ä–∞—Ç–µ–≥–∏–π

```python
# –ö–æ–Ω—Å–µ—Ä–≤–∞—Ç–∏–≤–Ω–∞—è —Å—Ç—Ä–∞—Ç–µ–≥–∏—è
engine1 = BacktestEngine()
engine1.min_confidence = 0.8  # –ë–æ–ª–µ–µ —Å—Ç—Ä–æ–≥–∏–π —Ñ–∏–ª—å—Ç—Ä —Å–∏–≥–Ω–∞–ª–æ–≤
engine1.stop_loss_percent = 1.5  # –£–∑–∫–∏–π —Å—Ç–æ–ø-–ª–æ—Å—Å
engine1.take_profit_percent = 3.0

results1 = engine1.run_backtest(
    symbols=['BTCUSDT', 'ETHUSDT'],
    interval='15',
    start_date=datetime.now() - timedelta(days=14),
    end_date=datetime.now()
)

# –ê–≥—Ä–µ—Å—Å–∏–≤–Ω–∞—è —Å—Ç—Ä–∞—Ç–µ–≥–∏—è
engine2 = BacktestEngine()
engine2.min_confidence = 0.6  # –ú–µ–Ω–µ–µ —Å—Ç—Ä–æ–≥–∏–π —Ñ–∏–ª—å—Ç—Ä
engine2.stop_loss_percent = 3.0  # –®–∏—Ä–æ–∫–∏–π —Å—Ç–æ–ø-–ª–æ—Å—Å
engine2.take_profit_percent = 6.0

results2 = engine2.run_backtest(
    symbols=['BTCUSDT', 'ETHUSDT'],
    interval='15',
    start_date=datetime.now() - timedelta(days=14),
    end_date=datetime.now()
)

# –°—Ä–∞–≤–Ω–µ–Ω–∏–µ
print("–ö–æ–Ω—Å–µ—Ä–≤–∞—Ç–∏–≤–Ω–∞—è:", results1['roi_percent'])
print("–ê–≥—Ä–µ—Å—Å–∏–≤–Ω–∞—è:", results2['roi_percent'])
```

### –ü—Ä–∏–º–µ—Ä 3: –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤

```python
from backtester import BacktestEngine
from datetime import datetime, timedelta

# –ü–µ—Ä–∏–æ–¥ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
start = datetime.now() - timedelta(days=30)
end = datetime.now()

# –¢–µ—Å—Ç–∏—Ä—É–µ–º —Ä–∞–∑–Ω—ã–µ stop-loss
best_roi = -999
best_sl = 0

for stop_loss in [1.0, 1.5, 2.0, 2.5, 3.0]:
    engine = BacktestEngine()
    engine.stop_loss_percent = stop_loss
    engine.take_profit_percent = stop_loss * 2  # 2:1 —Å–æ–æ—Ç–Ω–æ—à–µ–Ω–∏–µ
    
    results = engine.run_backtest(
        symbols=['BTCUSDT'],
        interval='15',
        start_date=start,
        end_date=end
    )
    
    roi = results['roi_percent']
    print(f"Stop-Loss: {stop_loss}% ‚Üí ROI: {roi:.2f}%")
    
    if roi > best_roi:
        best_roi = roi
        best_sl = stop_loss

print(f"\n–õ—É—á—à–∏–π Stop-Loss: {best_sl}% (ROI: {best_roi:.2f}%)")
```

---

## üìä –ú–µ—Ç—Ä–∏–∫–∏ –±—ç–∫—Ç–µ—Å—Ç–∞

### –û—Å–Ω–æ–≤–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏:

| –ú–µ—Ç—Ä–∏–∫–∞ | –û–ø–∏—Å–∞–Ω–∏–µ | –§–æ—Ä–º—É–ª–∞ |
|---------|----------|---------|
| **ROI** | –í–æ–∑–≤—Ä–∞—Ç –∏–Ω–≤–µ—Å—Ç–∏—Ü–∏–π | `(final - initial) / initial * 100` |
| **Total PnL** | –û–±—â–∞—è –ø—Ä–∏–±—ã–ª—å/—É–±—ã—Ç–æ–∫ | `final_balance - initial_balance` |
| **Win Rate** | –ü—Ä–æ—Ü–µ–Ω—Ç –ø—Ä–∏–±—ã–ª—å–Ω—ã—Ö —Å–¥–µ–ª–æ–∫ | `winning_trades / total_trades * 100` |
| **Max Drawdown** | –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –ø—Ä–æ—Å–∞–¥–∫–∞ | `(peak - trough) / peak * 100` |
| **Sharpe Ratio** | –†–∏—Å–∫-—Å–∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –¥–æ—Ö–æ–¥–Ω–æ—Å—Ç—å | `(mean_return - risk_free) / std_return` |
| **Profit Factor** | –û—Ç–Ω–æ—à–µ–Ω–∏–µ –ø—Ä–∏–±—ã–ª–∏ –∫ —É–±—ã—Ç–∫–∞–º | `total_profit / total_loss` |

### –ò–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤:

**ROI (Return on Investment):**
- `> 10%` üü¢ –û—Ç–ª–∏—á–Ω—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç
- `5-10%` üü° –•–æ—Ä–æ—à–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç
- `0-5%` üü† –ü—Ä–∏–µ–º–ª–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç
- `< 0%` üî¥ –£–±—ã—Ç–æ—á–Ω–∞—è —Å—Ç—Ä–∞—Ç–µ–≥–∏—è

**Win Rate:**
- `> 60%` üü¢ –í—ã—Å–æ–∫–∏–π win rate
- `50-60%` üü° –°—Ä–µ–¥–Ω–∏–π win rate
- `40-50%` üü† –ù–∏–∑–∫–∏–π win rate
- `< 40%` üî¥ –û—á–µ–Ω—å –Ω–∏–∑–∫–∏–π win rate

**Max Drawdown:**
- `< 10%` üü¢ –ù–∏–∑–∫–∏–π —Ä–∏—Å–∫
- `10-20%` üü° –°—Ä–µ–¥–Ω–∏–π —Ä–∏—Å–∫
- `20-30%` üü† –í—ã—Å–æ–∫–∏–π —Ä–∏—Å–∫
- `> 30%` üî¥ –û—á–µ–Ω—å –≤—ã—Å–æ–∫–∏–π —Ä–∏—Å–∫

**Sharpe Ratio:**
- `> 2.0` üü¢ –û—Ç–ª–∏—á–Ω—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç
- `1.0-2.0` üü° –•–æ—Ä–æ—à–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç
- `0.5-1.0` üü† –ü—Ä–∏–µ–º–ª–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç
- `< 0.5` üî¥ –ü–ª–æ—Ö–æ–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç

---

## ‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤

### –ü–∞—Ä–∞–º–µ—Ç—Ä—ã —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏:

```python
engine = BacktestEngine()

# –¢–æ—Ä–≥–æ–≤—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
engine.min_confidence = 0.7        # –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å AI (0-1)
engine.leverage = 5                # –ü–ª–µ—á–æ (1-125)

# –†–∏—Å–∫-–º–µ–Ω–µ–¥–∂–º–µ–Ω—Ç
engine.risk_percent = 2.0          # –ü—Ä–æ—Ü–µ–Ω—Ç –æ—Ç –±–∞–ª–∞–Ω—Å–∞ –Ω–∞ —Å–¥–µ–ª–∫—É
engine.max_position_percent = 20.0 # –ú–∞–∫—Å —Ä–∞–∑–º–µ—Ä –ø–æ–∑–∏—Ü–∏–∏
engine.stop_loss_percent = 2.0     # –°—Ç–æ–ø-–ª–æ—Å—Å –≤ %
engine.take_profit_percent = 4.0   # –¢–µ–π–∫-–ø—Ä–æ—Ñ–∏—Ç –≤ %

# –ù–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ç–æ—Ä–≥–æ–≤–ª–∏
engine.allow_long_positions = True   # –†–∞–∑—Ä–µ—à–∏—Ç—å –ª–æ–Ω–≥–∏
engine.allow_short_positions = True  # –†–∞–∑—Ä–µ—à–∏—Ç—å —à–æ—Ä—Ç—ã
engine.auto_position_reversal = True # –†–∞–∑–≤–æ—Ä–æ—Ç –ø–æ–∑–∏—Ü–∏–π
```

### –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –±—ç–∫—Ç–µ—Å—Ç–∞:

```python
results = engine.run_backtest(
    symbols=['BTCUSDT', 'ETHUSDT'],  # –¢–æ—Ä–≥–æ–≤—ã–µ –ø–∞—Ä—ã
    interval='15',                    # –¢–∞–π–º—Ñ—Ä–µ–π–º ('1', '5', '15', '30', '60', '240', 'D')
    start_date=datetime(...),         # –ù–∞—á–∞–ª—å–Ω–∞—è –¥–∞—Ç–∞
    end_date=datetime(...),           # –ö–æ–Ω–µ—á–Ω–∞—è –¥–∞—Ç–∞
    initial_balance=10000.0           # –ù–∞—á–∞–ª—å–Ω—ã–π –±–∞–ª–∞–Ω—Å
)
```

---

## üí∏ –ö–æ–º–∏—Å—Å–∏–∏ –∏ Slippage

### –ß—Ç–æ —ç—Ç–æ –∏ –∑–∞—á–µ–º?

**–ö–æ–º–∏—Å—Å–∏–∏ –±–∏—Ä–∂–∏** - –ø—Ä–æ—Ü–µ–Ω—Ç, –∫–æ—Ç–æ—Ä—ã–π –±–∏—Ä–∂–∞ –±–µ—Ä–µ—Ç –∑–∞ –∫–∞–∂–¥—É—é —Å–¥–µ–ª–∫—É:
- Maker fee: 0.055% (–æ—Ä–¥–µ—Ä –≤ —Å—Ç–∞–∫–∞–Ω–µ)
- Taker fee: 0.06% (—Ä—ã–Ω–æ—á–Ω—ã–π –æ—Ä–¥–µ—Ä)

**Slippage** - –ø—Ä–æ—Å–∫–∞–ª—å–∑—ã–≤–∞–Ω–∏–µ —Ü–µ–Ω—ã –º–µ–∂–¥—É –º–æ–º–µ–Ω—Ç–æ–º —Ä–µ—à–µ–Ω–∏—è –∏ –∏—Å–ø–æ–ª–Ω–µ–Ω–∏–µ–º:
- –ü—Ä–∏ –ø–æ–∫—É–ø–∫–µ —Ü–µ–Ω–∞ –æ–±—ã—á–Ω–æ –≤—ã—à–µ –æ–∂–∏–¥–∞–µ–º–æ–π
- –ü—Ä–∏ –ø—Ä–æ–¥–∞–∂–µ —Ü–µ–Ω–∞ –æ–±—ã—á–Ω–æ –Ω–∏–∂–µ –æ–∂–∏–¥–∞–µ–º–æ–π
- –¢–∏–ø–∏—á–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ: 0.05% –¥–ª—è –ª–∏–∫–≤–∏–¥–Ω—ã—Ö –ø–∞—Ä

### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∫–æ–º–∏—Å—Å–∏–π –∏ slippage

```python
from backtester import BacktestEngine

engine = BacktestEngine()

# –í–∫–ª—é—á–∏—Ç—å/–≤—ã–∫–ª—é—á–∏—Ç—å –∫–æ–º–∏—Å—Å–∏–∏ –∏ slippage
engine.use_fees_in_backtest = True      # –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é: True
engine.use_slippage_in_backtest = True  # –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é: True

# –ù–∞—Å—Ç—Ä–æ–∏—Ç—å —Ä–∞–∑–º–µ—Ä—ã (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ –∏–∑–º–µ–Ω–∏—Ç—å)
engine.maker_fee_percent = 0.055   # Bybit maker fee
engine.taker_fee_percent = 0.06    # Bybit taker fee
engine.slippage_percent = 0.05     # –ü—Ä–æ—Å–∫–∞–ª—å–∑—ã–≤–∞–Ω–∏–µ

# –ó–∞–ø—É—Å—Ç–∏—Ç—å –±—ç–∫—Ç–µ—Å—Ç
results = engine.run_backtest(...)
```

### –í–ª–∏—è–Ω–∏–µ –Ω–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã

**–ü—Ä–∏–º–µ—Ä: –°–¥–µ–ª–∫–∞ –Ω–∞ $1000**
```
–ë–µ–∑ –∫–æ–º–∏—Å—Å–∏–π –∏ slippage:
  –í—Ö–æ–¥: $43,000.00
  –í—ã—Ö–æ–¥: $43,200.00
  PnL: $200.00 (+0.47%)

–° –∫–æ–º–∏—Å—Å–∏—è–º–∏ –∏ slippage:
  –í—Ö–æ–¥: $43,021.50 (slippage +0.05%)
  –ö–æ–º–∏—Å—Å–∏—è –≤—Ö–æ–¥–∞: $0.60 (0.06%)
  –í—ã—Ö–æ–¥: $42,978.50 (slippage -0.05%)
  –ö–æ–º–∏—Å—Å–∏—è –≤—ã—Ö–æ–¥–∞: $0.60 (0.06%)
  PnL: $178.20 (+0.41%)
  
–†–∞–∑–Ω–∏—Ü–∞: -$21.80 (-10.9% –æ—Ç –ø—Ä–∏–±—ã–ª–∏)
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–ª–∏—è–Ω–∏—è

–°—Ä–∞–≤–Ω–∏—Ç–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã —Å –∫–æ–º–∏—Å—Å–∏—è–º–∏ –∏ –±–µ–∑:

```python
# –ë—ç–∫—Ç–µ—Å—Ç –ë–ï–ó –∫–æ–º–∏—Å—Å–∏–π
engine1 = BacktestEngine()
engine1.use_fees_in_backtest = False
engine1.use_slippage_in_backtest = False
results1 = engine1.run_backtest(...)

# –ë—ç–∫—Ç–µ—Å—Ç –° –∫–æ–º–∏—Å—Å–∏—è–º–∏
engine2 = BacktestEngine()
engine2.use_fees_in_backtest = True
engine2.use_slippage_in_backtest = True
results2 = engine2.run_backtest(...)

# –°—Ä–∞–≤–Ω–µ–Ω–∏–µ
print(f"ROI –±–µ–∑ –∫–æ–º–∏—Å—Å–∏–π: {results1['roi_percent']:.2f}%")
print(f"ROI —Å –∫–æ–º–∏—Å—Å–∏—è–º–∏: {results2['roi_percent']:.2f}%")
print(f"–í—Å–µ–≥–æ –∫–æ–º–∏—Å—Å–∏–π: ${results2['total_fees_paid']:.2f}")
```

–ò–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –≥–æ—Ç–æ–≤—ã–π —Ç–µ—Å—Ç–æ–≤—ã–π —Å–∫—Ä–∏–ø—Ç:

```bash
python src/test_fees_slippage.py
```

### –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –≤ –æ—Ç—á–µ—Ç–∞—Ö

–†–µ–∑—É–ª—å—Ç–∞—Ç—ã –±—ç–∫—Ç–µ—Å—Ç–∞ —Ç–µ–ø–µ—Ä—å –≤–∫–ª—é—á–∞—é—Ç:

```python
{
    'total_fees_paid': 12.45,      # –í—Å–µ–≥–æ –∫–æ–º–∏—Å—Å–∏–π
    'total_entry_fees': 6.23,      # –ö–æ–º–∏—Å—Å–∏–∏ –ø—Ä–∏ –≤—Ö–æ–¥–µ
    'total_exit_fees': 6.22,       # –ö–æ–º–∏—Å—Å–∏–∏ –ø—Ä–∏ –≤—ã—Ö–æ–¥–µ
    'roi_percent': 8.5,            # ROI —Å —É—á–µ—Ç–æ–º –∫–æ–º–∏—Å—Å–∏–π
    'profit_factor': 1.8,          # Profit Factor (–ø—Ä–∏–±—ã–ª—å/—É–±—ã—Ç–∫–∏)
    ...
}
```

### –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

‚úÖ **–í–°–ï–ì–î–ê –≤–∫–ª—é—á–∞–π—Ç–µ –∫–æ–º–∏—Å—Å–∏–∏ –∏ slippage** –¥–ª—è —Ä–µ–∞–ª–∏—Å—Ç–∏—á–Ω–æ–π –æ—Ü–µ–Ω–∫–∏ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏

‚ö†Ô∏è **–°—Ç—Ä–∞—Ç–µ–≥–∏—è –º–æ–∂–µ—Ç –±—ã—Ç—å –ø—Ä–∏–±—ã–ª—å–Ω–æ–π –±–µ–∑ –∫–æ–º–∏—Å—Å–∏–π, –Ω–æ —É–±—ã—Ç–æ—á–Ω–æ–π —Å –Ω–∏–º–∏!**

üìä **–í—ã—Å–æ–∫–æ—á–∞—Å—Ç–æ—Ç–Ω—ã–µ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏** –æ—Å–æ–±–µ–Ω–Ω–æ —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã –∫ –∫–æ–º–∏—Å—Å–∏—è–º

üí° **–û–ø—Ç–∏–º–∏–∑–∏—Ä—É–π—Ç–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–¥–µ–ª–æ–∫** - –º–µ–Ω—å—à–µ —Å–¥–µ–ª–æ–∫ = –º–µ–Ω—å—à–µ –∫–æ–º–∏—Å—Å–∏–π

---

## üîç –ê–Ω–∞–ª–∏–∑ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤:

```python
{
    'initial_balance': 10000.0,
    'final_balance': 11250.50,
    'total_pnl': 1250.50,
    'roi_percent': 12.51,
    'total_trades': 42,
    'winning_trades': 28,
    'losing_trades': 14,
    'win_rate': 66.67,
    'highest_balance': 11500.00,
    'lowest_balance': 9800.00,
    'max_drawdown': 14.78,
    'sharpe_ratio': 1.85,
    'profit_factor': 2.15
}
```

### –î–æ—Å—Ç—É–ø –∫ –¥–µ—Ç–∞–ª—å–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏:

```python
# –ü–æ–ª—É—á–∏—Ç—å –≤—Å–µ –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã–µ –ø–æ–∑–∏—Ü–∏–∏
positions = engine.db.get_virtual_open_positions()

# –ü–æ–ª—É—á–∏—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
stats = engine.get_virtual_stats()

# –ò—Å—Ç–æ—Ä–∏—è —Å–¥–µ–ª–æ–∫
# TODO: –î–æ–±–∞–≤–∏—Ç—å –º–µ—Ç–æ–¥ –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –∏—Å—Ç–æ—Ä–∏–∏ –≤—Å–µ—Ö —Å–¥–µ–ª–æ–∫
```

---

## üí° –õ—É—á—à–∏–µ –ø—Ä–∞–∫—Ç–∏–∫–∏

### 1. –ù–∞—á–∏–Ω–∞–π—Ç–µ —Å –º–∞–ª–æ–≥–æ

```python
# –°–Ω–∞—á–∞–ª–∞ –∫–æ—Ä–æ—Ç–∫–∏–π –ø–µ—Ä–∏–æ–¥ –¥–ª—è –±—ã—Å—Ç—Ä–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏
results = engine.run_backtest(
    symbols=['BTCUSDT'],
    interval='15',
    start_date=datetime.now() - timedelta(days=7),
    end_date=datetime.now()
)

# –ó–∞—Ç–µ–º —Ä–∞—Å—à–∏—Ä—è–π—Ç–µ –µ—Å–ª–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ö–æ—Ä–æ—à–∏–µ
if results['roi_percent'] > 5:
    # –¢–µ—Å—Ç–∏—Ä—É–µ–º –Ω–∞ –±–æ–ª–µ–µ –¥–ª–∏—Ç–µ–ª—å–Ω–æ–º –ø–µ—Ä–∏–æ–¥–µ
    results_long = engine.run_backtest(
        symbols=['BTCUSDT', 'ETHUSDT'],
        interval='15',
        start_date=datetime.now() - timedelta(days=90),
        end_date=datetime.now()
    )
```

### 2. –¢–µ—Å—Ç–∏—Ä—É–π—Ç–µ –Ω–∞ —Ä–∞–∑–Ω—ã—Ö —Ä—ã–Ω–∫–∞—Ö

```python
# –ë—ã—á–∏–π —Ä—ã–Ω–æ–∫ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –Ω–æ—è–±—Ä—å 2024)
results_bull = engine.run_backtest(
    start_date=datetime(2024, 11, 1),
    end_date=datetime(2024, 11, 30),
    ...
)

# –ú–µ–¥–≤–µ–∂–∏–π —Ä—ã–Ω–æ–∫
results_bear = engine.run_backtest(
    start_date=datetime(2024, 8, 1),
    end_date=datetime(2024, 8, 30),
    ...
)

# –ë–æ–∫–æ–≤–æ–π —Ä—ã–Ω–æ–∫
results_sideways = engine.run_backtest(
    start_date=datetime(2024, 7, 1),
    end_date=datetime(2024, 7, 30),
    ...
)
```

### 3. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–µ—à

```python
# –ü–µ—Ä–≤—ã–π –∑–∞–ø—É—Å–∫ - –∑–∞–≥—Ä—É–∂–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ —Å API
results1 = engine.run_backtest(...)  # ~30 —Å–µ–∫—É–Ω–¥

# –ü–æ–≤—Ç–æ—Ä–Ω—ã–π –∑–∞–ø—É—Å–∫ - –∏–∑ –∫–µ—à–∞ –ë–î
results2 = engine.run_backtest(...)  # ~5 —Å–µ–∫—É–Ω–¥
```

### 4. –°—Ä–∞–≤–Ω–∏–≤–∞–π—Ç–µ —Å –±–µ–Ω—á–º–∞—Ä–∫–æ–º

```python
# –°—Ç—Ä–∞—Ç–µ–≥–∏—è –±–æ—Ç–∞
bot_results = engine.run_backtest(...)

# "Buy and Hold" —Å—Ç—Ä–∞—Ç–µ–≥–∏—è (–ø—Ä–æ—Å—Ç–æ –∫—É–ø–∏—Ç—å –∏ –¥–µ—Ä–∂–∞—Ç—å)
initial_price = historical_data['BTCUSDT'][0]['close']
final_price = historical_data['BTCUSDT'][-1]['close']
buy_hold_roi = ((final_price - initial_price) / initial_price) * 100

if bot_results['roi_percent'] > buy_hold_roi:
    print("‚úÖ –ë–æ—Ç –ø—Ä–µ–≤–∑–æ—à–µ–ª Buy & Hold!")
else:
    print("‚ö†Ô∏è Buy & Hold –±—ã–ª –±—ã –ª—É—á—à–µ")
```

---

## ‚ö†Ô∏è –í–∞–∂–Ω—ã–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è

### –¢–µ–∫—É—â–∏–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è —Å–∏—Å—Ç–µ–º—ã:

1. ‚úÖ **–£—á–µ—Ç –∫–æ–º–∏—Å—Å–∏–π –±–∏—Ä–∂–∏** - –†–ï–ê–õ–ò–ó–û–í–ê–ù–û (Task 4.3)
2. ‚úÖ **–£—á–µ—Ç slippage** - –†–ï–ê–õ–ò–ó–û–í–ê–ù–û (Task 4.3)
3. **–ë–∞–∑–æ–≤—ã–π —Ä–∞—Å—á–µ—Ç Sharpe Ratio** (—Ç—Ä–µ–±—É–µ—Ç—Å—è —É–ª—É—á—à–µ–Ω–∏–µ - Task 4.4)
4. **–ù–µ—Ç –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏** (–ø–ª–∞–Ω–∏—Ä—É–µ—Ç—Å—è –≤ Task 4.5)

### –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è:

‚ö†Ô∏è **–ü—Ä–æ—à–ª—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –Ω–µ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É—é—Ç –±—É–¥—É—â—É—é –ø—Ä–∏–±—ã–ª—å**  
‚ö†Ô∏è **–ë—ç–∫—Ç–µ—Å—Ç –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –∏–¥–µ–∞–ª—å–Ω–æ–µ –∏—Å–ø–æ–ª–Ω–µ–Ω–∏–µ** (–≤ —Ä–µ–∞–ª—å–Ω–æ—Å—Ç–∏ –º–æ–∂–µ—Ç –±—ã—Ç—å —Ö—É–∂–µ)  
‚ö†Ô∏è **–ù–µ —Ç–µ—Å—Ç–∏—Ä—É–π—Ç–µ –Ω–∞ —Ç–µ—Ö –∂–µ –¥–∞–Ω–Ω—ã—Ö –≥–¥–µ –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–ª–∏** (overfitting)  
‚ö†Ô∏è **–í—Å–µ–≥–¥–∞ —Ç–µ—Å—Ç–∏—Ä—É–π—Ç–µ —Å–Ω–∞—á–∞–ª–∞ –Ω–∞ testnet, –ø–æ—Ç–æ–º –Ω–∞ production**

---

## üêõ –†–µ—à–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º

### –ü—Ä–æ–±–ª–µ–º–∞: "–ù–µ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –¥–∞–Ω–Ω—ã–µ"

```python
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ —Å Bybit
from bybit_client import BybitClient
bybit = BybitClient()
data = bybit.get_market_data('BTCUSDT')
print(data)  # –î–æ–ª–∂–µ–Ω –≤–µ—Ä–Ω—É—Ç—å –¥–∞–Ω–Ω—ã–µ
```

### –ü—Ä–æ–±–ª–µ–º–∞: "–ú–µ–¥–ª–µ–Ω–Ω–æ —Ä–∞–±–æ—Ç–∞–µ—Ç"

```python
# 1. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–µ—à
results = engine.run_backtest(..., use_cache=True)

# 2. –£–º–µ–Ω—å—à–∏—Ç–µ –ø–µ—Ä–∏–æ–¥ –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –±–æ–ª—å—à–∏–π —Ç–∞–π–º—Ñ—Ä–µ–π–º
interval='60'  # –≤–º–µ—Å—Ç–æ '15'

# 3. –ú–µ–Ω—å—à–µ —Å–∏–º–≤–æ–ª–æ–≤
symbols=['BTCUSDT']  # –≤–º–µ—Å—Ç–æ –º–Ω–æ–∂–µ—Å—Ç–≤–∞ –ø–∞—Ä
```

### –ü—Ä–æ–±–ª–µ–º–∞: "–ú–∞–ª–æ —Å–¥–µ–ª–æ–∫"

```python
# –°–Ω–∏–∑—å—Ç–µ min_confidence
engine.min_confidence = 0.6  # –≤–º–µ—Å—Ç–æ 0.8

# –ò–ª–∏ –∏–∑–º–µ–Ω–∏—Ç–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã —Ä–∏—Å–∫-–º–µ–Ω–µ–¥–∂–º–µ–Ω—Ç–∞
engine.risk_percent = 3.0  # –±–æ–ª—å—à–µ —Ä–∏—Å–∫ = –±–æ–ª—å—à–µ —Å–¥–µ–ª–æ–∫
```

---

## üìö –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ä–µ—Å—É—Ä—Å—ã

- [BACKTEST_PROGRESS.md](BACKTEST_PROGRESS.md) - –ü—Ä–æ–≥—Ä–µ—Å—Å —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
- [ARCHITECTURE.md](ARCHITECTURE.md) - –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞
- [TASKS.md](TASKS.md) - –¢–µ–∫—É—â–∏–µ –∑–∞–¥–∞—á–∏

---

## üöÄ Roadmap

### ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ:
- –ë–∞–∑–æ–≤—ã–π –¥–≤–∏–∂–æ–∫ –±—ç–∫—Ç–µ—Å—Ç–∏–Ω–≥–∞
- –ó–∞–≥—Ä—É–∑–∫–∞ –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏—Ö –¥–∞–Ω–Ω—ã—Ö
- –ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ –ë–î
- –û—Å–Ω–æ–≤–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏

### üîÑ –í —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ:
- Task 4.3: –£—á–µ—Ç –∫–æ–º–∏—Å—Å–∏–π –∏ slippage
- Task 4.4: –£–ª—É—á—à–µ–Ω–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏ (Sharpe, Profit Factor)

### üìÖ –ü–ª–∞–Ω–∏—Ä—É–µ—Ç—Å—è:
- Task 4.5: Web UI —Å –≥—Ä–∞—Ñ–∏–∫–∞–º–∏
- –≠–∫—Å–ø–æ—Ä—Ç –æ—Ç—á–µ—Ç–æ–≤ –≤ PDF/HTML
- –°—Ä–∞–≤–Ω–µ–Ω–∏–µ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö —Å—Ç—Ä–∞—Ç–µ–≥–∏–π
- Walk-forward analysis

---

**–°–æ–∑–¥–∞–Ω–æ:** 2025-12-06  
**–í–µ—Ä—Å–∏—è:** 0.1.0-alpha  
**–°—Ç–∞—Ç—É—Å:** Ready for testing üß™

